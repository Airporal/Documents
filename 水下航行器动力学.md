# 水下航行器动力学



---



## 1. 简介

### 1.1 Underwater Vehicle 分类

>根据受力与运动自由度对水下航行器进行分类，不同分类的水下航行器运动性质不一样。

​	水下航行器受到静态力（浮力）和动态力（Approximately proportional to the square of the relative speed to the water)，各个力是否占主导作用可由Froude Number 判断：
$$
F_{n}:=\frac{U}{\sqrt{gL}}
$$
其中U表示航行器速度，g表示重力加速度，L表示航行器整体淹没的长度。

​	当$F_n<0.4$时：浮力相对于附加质量和阻力占主导作用；

​	当$0.4-0.5<F_n<1.0-1.2$时：在高速潜体型艇的最大运行速度下，浮力不占主导地位；

​	当$F_n>1.0-1.2$ 动态力占主导作用，会有强烈的气流分离，气动升力和阻力开始发挥作用。

:boat:水下航行器通常拥有六个自由度，其body随动坐标系以前进方向为x轴，向下为z轴，按照右手定则建立，并将六个自由度命名为：

![b15ffb740924516376e9a26ccaedf6c](https://gitee.com/airporal/image_hub/raw/master/img/202505171610750.jpg)

$$
x-y-z:surge-sway-heavy:roll-pitch-yaw
$$

> [!NOTE]
>
> Roll通常存在较大加速度，容易导致晕船；pitch和heave也会使人不适。surge、sway、yaw是在水面的运动，surge通常与速度控制相关，yaw决定航向。

​	按照自由度，可将常见水下航行器运动系统**解耦后**划分为1DOF、3DOF、4DOF、6DOF四种：

+ 1DOF：通常仅具备速度控制（surge)或航向控制（yaw）或横滚控制（roll）
+ 3DOF：水平面运动模式（surge、swap、yaw）、竖直面运动模式（surge、heavy、pitch）、横向运动模式（roll、sway、yaw）
+ 4DOF：通过对鳍、舵、稳定液柜的控制，将roll添加到水平面运动模式中，形成（surge、sway、roll、yaw）。
+ 6DOF：包含surge、swap、heavy、roll、pitch、yaw的六自由度运动模式。

### 1.2 运动模型分类

​	水下航行器动力学建模的目的可能是预测、实时仿真、控制与观测器设计，不同目的所需的微分方程的复杂性和数量是不同的。分为以下三类：

+ 仿真模型

​	仿真模型是对一个系统最为精确的描述，例如，一个用于运动解耦仿真的高精度六自由度时域模型。包括航行器的动力学、推进器系统、测量系统、风、浪、流载荷。仿真模型需要能够模拟真实系统随时间变化的过程，并且可以在发生事故或错误信号时触发故障模式。受附加质量和势流阻尼的影响，仿真模型会包含流体记忆效应（fluid-meory effects），并且通常由50-200个常微分方程（ODEs Ordinary differential equations）组成，而仅需要12个ODEs就可以生成六自由度的位置和速度。此外，一些系统需要额外对环境力和驱动器进行描述，但是单个航行器状态的总数仍然少于50。

+ 控制模型

​	控制模型是仿真模型的简化或降维，用于设计水下航行器的控制系统。通常基于这个简化的模型来设计PID控制器的系数，更复杂的控制系统会使用动力学模型生成一些前馈和反馈信号，这种基于模型的运动控制系统通常需要少于20个ODEs。典型的PID控制模型包括积分项系数和用于限制放大噪音的低通滤波器系数两个状态。此外，六自由度的定点巡航任务可以通过12个ODEs实现，而轨迹跟踪控制需要额外的前馈和滤波，高阶的控制率并不罕见。

+ 观测模型

​	观测模型的作用是捕获与传感器和导航系统以及干扰相关的动力学信息，它是仿真模型的简化版本，关注于测量噪声、航位推算、滤波和运动预测。基于模型的水下航行器观测器通常包括扰动模型，通过将风、浪、流载荷处理为colored noise，来估计扰动。动态定位（Dynamic positioning）的水下航行器的状态估计系统通常包括20个ODEs，而基本的艏向控制系统仅通过五个状态即可实现。

### 1.3 水下航行器经典模型

​	对于质量为m，质心为$(x_g,y_g,z_g)$的水下航行器，六自由度方向受到的力（X，Y，Z）和力矩（K，M，N）
$$
\begin{aligned}
 & X=m\left[\dot{u}-vr+wq-x_{g}\left(q^{2}+r^{2}\right)+y_{g}\left(pq-\dot{r}\right)+z_{g}\left(pr+\dot{q}\right)\right] \\
 & Y=m\left[\dot{v}-wp+ur-y_{g}\left(r^{2}+p^{2}\right)+z_{g}\left(qr-\dot{p}\right)+x_{g}\left(qp+\dot{r}\right)\right] \\
 & Z=m\left[\dot{w}-uq+vp-z_{g}\left(p^{2}+q^{2}\right)+x_{g}\left(rp-\dot{q}\right)+y_{g}\left(rq+\dot{p}\right)\right] \\
 & K=I_{x}\dot{p}+(I_{z}-I_{y})qr-(\dot{r}+pq)I_{xz}+(r^{2}-q^{2})I_{yz}+(pr-\dot{q})I_{xy} \\
 &\qquad+m\left[y_{g}\left(\dot{w}-uq+vp\right)-z_{g}\left(\dot{v}-wp+ur\right)\right] \\
 & M=I_{y}\dot{q}+(I_{x}-I_{z})rp-(\dot{p}+qr)I_{xy}+(p^{2}-r^{2})I_{zx}+(qp-\dot{r})I_{yz} \\
 & \qquad+m\left[z_{g}\left(\dot{u}-vr+wq\right)-x_{g}\left(\dot{w}-uq+vp\right)\right] \\
 & N=I_{z}\dot{r}+(I_{y}-I_{x})pq-(\dot{q}+rp)I_{yz}+(q^{2}-p^{2})I_{xy}+(rq-\dot{p})I_{zx} \\
 & \qquad+m\left[x_{g}\left(\dot{v}-wp+ur\right)-y_{g}\left(\dot{u}-vr+wq\right)\right]
\end{aligned}
$$

​	该公式是水下航行器在时域上的基本的动力学模型，额外的力和力矩使用操纵性理论和耐波理论表达：

+ **操纵性理论：**操纵性理论关于水下航行器在常速度下运动的研究基于水动力系数为常数且没有波浪的假设。操纵性模型的表述是线性的，非线性的部分可以用**横流阻力、二次阻尼或泰勒展开**等方法推导。

​	操纵性理论假设水下航行器在温暖的受限水域运动，并且假设波浪频率为零，此时附加质量和阻尼可以使用水动力衍射的常量系数表示。零频率假设仅仅在surge\sway\yaw上有效，因为PD控制器的自然周期在100~150s内，对于150s的周期，自然频率约为0.04，接近0。而在roll\pitch\heavy上自然频率会高很多，例如船舶roll振动周期达到10s，自然频率接近0.628，不再满足零频率假设，此时，单独考虑纯横滚运动时，需要在频率为0.628Hz/s的状态下计算附加质量和阻尼。
$$
M_{RB}\dot{v} + C_{RB}(v)v = \tau_{RB}
\\

\tau_{RB} = \underbrace{\tau_{hyd} + \tau_{hs}}_{hydrodynamic\ \ \ hydrostatic forces} + \underbrace{\tau_{wind} + \tau_{wave}}_{environmental forces} + \tau_{control}
$$
其中，$M_{RB}$是刚体的惯性矩阵，$C_{RB}$是刚体的科氏力和向心力矩阵。

​	阻尼主要包括波浪影响和粘性阻尼，科氏力和向心力是由于机体坐标系相对于惯性坐标系旋转参数。关于水动力项$\tau_{hyd}$，可以使用线性或非线性理论表示：

​	:a:线性理论

​	六自由度线性方程中，总共有与速度和加速度成比例的共36个质量元素和36个阻尼元素，此外还会受到恢复力、推力、环境力作用。使用SNAME表示线性附加质量和阻尼力：
$$
\begin{aligned}
 X_{1}=X_{u}u+X_{v}v+X_{w}w+X_{p}p+X_{q}q+X_{r}r \\
+X_{\dot{u}}\dot{u}+X_{\dot{v}}\dot{v}+X_{\dot{v}}\dot{w}+X_{\dot{p}}\dot{p}+X_{\dot{q}}\dot{q}+X_{\dot{r}}\dot{r}\\
...\\
N_1=N_{u}u+N_{v}v+N_{v}w+N_{p}p+N_{q}q+N_{r}r \\
+N_{\hat{u}}\dot{u}+N_{\hat{v}}\dot{v}+N_{\hat{v}}\dot{w}+N_{\hat{p}}\dot{p}+N_{\hat{q}}\dot{q}+N_{\hat{r}}\dot{r}
\end{aligned}
$$
其中$X_{u,v,w,p,q,r}$表示线性阻尼系数，$X_{\dot{u},\dot{v},\dot{w},\dot{p},\dot{q},\dot{r}}$表示水动力附加质量系数。

​	:b:非线性理论

​	非线性理论除了考虑36个线性元素外，还需要考虑其它的非线性项。常用的方法包括截断泰勒级数展开和第一性原则。

​	截断泰勒级数展开将水动力表达式展开到1阶和3阶或者1阶和2阶。然后通过PMM实验数据拟合这些水动力系数。

​	第一性原理使用拉格朗日模型保留能量特性，相比于泰勒展开，基于第一性原理建立的模型通常需要更少的参数。

+ **耐波性理论：**水下航行器在波浪中的零速度或恒定速度运动可以用耐波性理论来分析其中水动力系数和波浪载荷利用波浪激励频率和水下航行器几何形状与质量分布的方程计算。

​	波性理论研究存在波浪激励但航行器艏向角与航行速度一定的情况下的运动。耐波性理基于与平衡位置固定的耐波性坐标系（s Frame)、和航行器固定的机体坐标系（b Frame）以及NED 坐标系，研究对扰动的控制能力。

![070859de681af40ee0381e763d48c9e](https://gitee.com/airporal/image_hub/raw/master/img/202505201506441.jpg)

​	🚤根据Cummins方程，时域上的控制模型为：
$$
\left[ M_{RB}+A \left( \infty \right) \right] \ddot{ \xi}+B_{total} \left( \infty \right) \dot{ \xi}+ \int_{0}^{t}K \left( t- \tau \right) \dot{ \xi} \left( \tau \right) d \tau+C \xi= \tau_{wind}+ \tau_{wave}+ \delta \tau
$$
​	其中$\delta\tau$是推进器和控制面的扰动，$A \left( \infty \right) $是无穷频率的附加质量矩阵，$B_{total}=B \left( \infty \right)+B_V\left( \infty \right)$是无穷频率的阻尼矩阵，包括势流阻尼和粘性阻尼。$\xi$是六自由度扰动向量，C是弹性刚度矩阵，K(t)是一个时变矩阵：
$$
K \left( t \right)= \frac{2}{ \pi} \int_{0}^{ \infty} \left[ B_{total} \left( \omega \right)-B_{total} \left( \infty \right) \right] \cos \left( \omega t \right) d \omega
$$
​	🚤频域上的控制模型为：
$$
\left( -\omega^2 \left[M_{RB} + A(\omega) \right] - j\omega B_{\text{total}}(\omega) + C \right) \xi(j\omega)=\tau_{\text{wind}}(j\omega) + \tau_{\text{wave}}(j\omega) + \delta\tau(j\omega)
$$
​	其中，$\xi(jw)$为：
$$
\xi_{i} \left( t \right)= \overline{ \xi}_{i} \cos \left( \omega t+ \epsilon_{i} \right) \Rightarrow \xi_{i} \left( j \omega \right)= \overline{ \xi}_{i} \exp \left( j \epsilon_{i} \right)
$$
​	⛴️此外，根据pseudo-differential 方程可以结合时域与频域表达：
$$
\left[ M_{RB}+A \left( \omega \right) \right] \ddot{ \xi}+B_{total} \left( \omega \right) \dot{ \xi}+C \xi= \tau_{wind}+ \tau_{wave}+ \delta \tau
$$
​	通常使用时域或频域的表达形式，并在线性理论和谐波运动（此时结果在时域下是线性的）的假设下进行仿真计算。

> [!IMPORTANT]
>
> ​	🚩对于在波浪影响下工作的水下航行器，波浪频率并不会影响水动力的质量和阻尼系数，因此，可以用恒定的水动力系数来模拟水下航行器。

​	🆎:Fossen's Model

​	1991年，Fossen将操纵性理论和耐波性理论中的物理属性应用到向量化表示的海洋航行器的运动方程中。传统的根据线性理论或非线性理论建立的经典模型动力学表达形式通常包括大量元素，且以分量形式表示，这不适合大规模计算，Fossen通过矩阵与向量的形式表示，适合计算与控制系统设计：
$$
M \dot{v}+C \left( v \right) v+D \left( v \right) v+g \left( \eta \right)+g_{0}= \tau+ \tau_{wind}+ \tau_{wave}
$$
​	$\boldsymbol{v}$和$\boldsymbol{\eta}$表示六自由度的速度与位置向量，$\boldsymbol{\tau}$表示六自由度的广义力（包括力与力矩），M表示惯性矩阵，C(v)表示科氏力，D表示阻尼矩阵，$g \left( \eta \right)$表示重力和浮力向量，$g_{0}$表示静态恢复力、恢复力矩。

​	Fossen的向量形式模型使得系统的对称性、偏对称性、正定性等属性可以被考虑进稳定性分析中。

### 1.4 符号说明及注释

|                        **符号**                         |                           **说明**                           |
| :-----------------------------------------------------: | :----------------------------------------------------------: |
|                    $\boldsymbol{v}$                     |                       $[u,v,w,p,q,r]$                        |
|                   $\boldsymbol{\tau}$                   |                       $[X,Y,Z,K,M,N]$                        |
|                   $\boldsymbol{\eta}$                   |                  $[x,y,z,\phi,\theta,\psi]$                  |
| $\vec{u}=u_1^n\vec{n}_1+u_2^n\vec{n}_2+u_3^n\vec{n}_3$  |                 用n系下的单位向量表示向量$u$                 |
|        $\boldsymbol{u^n}=[u_1^n,u_2^n,u_3^n]^T$         |                坐标表示的向量$\boldsymbol{u}$                |
|                $\boldsymbol{v}^e_{b/n}$                 |             点$O_b$相对于n系的速度在e系中的表示              |
|                $\boldsymbol{w}^b_{n/e}$                 |              n系相对于e系的加速度在b系中的表示               |
|                 $\boldsymbol{f}^n_{b}$                  |                 作用于$O_b$的力在n系中的表示                 |
|                 $\boldsymbol{m}^n_{b}$                  |                作用于$O_b$的力矩在n系中的表示                |
|                      $\Theta_{nb}$                      |                     n系与b系之间的欧拉角                     |
|                     $\mathbb{R}^3$                      |                         三维欧拉空间                         |
|                     $\mathit{S}^2$                      | $\{(x,y,z)\in \mathbb{R}^3|x^2+y^2+z^2=1\}$三维空间中半径为1的球面（经纬度） |
|                     $\mathit{S}^3$                      | $\{(x,y,z,k)\in \mathbb{R}^4|x^2+y^2+z^2+k^2=1\}$四维空间中半径为1的超球面（欧拉角） |
|                        $\\R^a_b$                        |                     a和b系之间的旋转矩阵                     |
|                         $SO(3)$                         | $SO(3)=\{R|R\in\mathbb{R}^{3\times3},R是正交阵，且行列式为1\}$；是O(3)的子集 |
|                         $O(3)$                          |     $O(3):=\{R|R\in\mathbb{R}^{3\times3},RR^T=R^TR=I\}$      |
|                  $s.\ \ \ c.\ \ \ t.$                   |        $sin(.)\ \ \ \ \ cos(.)\ \ \ \  tan(.)$的简写         |
| $\boldsymbol \lambda \times a=S(\boldsymbol \lambda )a$ | $S(\lambda)=-S^{\top}(\lambda)=\begin{bmatrix}0 & -\lambda_3 & \lambda_2 \\\lambda_3 & 0 & -\lambda_1 \\-\lambda_2 & \lambda_1 & 0\end{bmatrix}$向量叉乘。 |
|                     $\overline{BG}$                     | 表示B和G点的距离$\overline{BG}:=[\overline{BG}_x,\overline{BG}_y,\overline{BG}_z]^T=[x_g-x_b,y_g-y_b,z_g-z_b]^T$ |
|                    $\boldsymbol \xi$                    |                       六自由度位置误差                       |
|                          SE(n)                          | $SE(n)=\{(R,P)|R\in SO(n),P\in R^n\}$n维度欧式变幻，和位姿变化J矩阵对应。 |
|                                                         |                                                              |
|                                                         |                                                              |
|                                                         |                                                              |
|                                                         |                                                              |
|                                                         |                                                              |
|                                                         |                                                              |
|                                                         |                                                              |
|                                                         |                                                              |

**Coriolis Force 科氏力：**科氏力实际上并不存在，但由于旋转系与惯性系中的匀速直线运动的差异，当一个质点在惯性系中匀速直线运动时，在旋转系中轨迹是曲线，因此引入科氏力来描述两个坐标系间的运动差异，即在惯性系中直线运动的物体，相当于在旋转系中受到科氏力的作用运动。

## 2. 运动学(Kinematics)

> Dynamic分为仅考虑几何外形的运动学以及考虑受力对运动影响的Kinetics的两部分。

$$
\begin{align}\dot{\eta} &= J_{\Theta}(\eta)v \\M\dot{v} + C(v)v + D(v)v + g(\eta) + g_0 &= \tau + \tau_{\text{wind}} + \tau_{\text{wave}}\end{align}
$$

​	公式(1)和公式(2)即是Fossen公式。需要注意的是，由于重力和浮力影响的两项$g(\eta)$和$g_0$之间的差异，前者是由于水下航行器位姿变化而产生的包括重力和浮力产生的静态水动力影响，是一个非线性项，后者是由于重心、浮心不重合导致的恒定偏置力或力矩项，是一个常数项。

### 2.1 坐标系

#### 2.1.1 Earth-Centered Reference Frames

![2ea6e4cd90adf305f476ebe3618d5b4](https://gitee.com/airporal/image_hub/raw/master/img/202505211951373.jpg)

+ ECI

​	ECI(Earth-centered inertial frame)是用于卫星导航的**惯性系**${i}=(x_i,y_i,z_i)$，惯性系无加速度，牛顿定律可以直接使用。惯性系的原点在地球中心。

+ ECEF

​	ECEF(Earth-centered Earth-fixed frame)是考虑地球自转的**惯性系**$e=(x_e,y_e,z_e)$，ECEF原点固定在球心，z轴和ECI重合，但是x-y绕z轴以地球自转角速度$w=7.2921\times10^{-5}rad/s$旋转。当航行器一相对较低的速度运动时，可以忽略地球自转，此时，ECEF和ECI重合。ECEF一般用于导航与控制。

#### 2.1.2 Geographic Reference Frames

+ NED

​	NED(North-East-Down，$n=(x_n,y_n,z_n)$)是以机器人所在点为坐标系原点，以地球的北方为x轴，东方为y轴，向下为z轴的坐标系。NED与ECEF坐标系的相对关系一般用经度和纬度定义。

​	NED坐标系常用于具备范围内的机器人运动控制，并假设在运动过程中经纬度不变，假设地球在某点是平的， 此时可以在某点的切面上应用NED进行导航。NED通常考虑为**惯性系**，因此牛顿定律适用。

+ BODY

![a7f52102c97a18f3c532730f68cf1d9](https://gitee.com/airporal/image_hub/raw/master/img/202505212023354.jpg)

​	BODY($b=(x_b,y_b,z_b)$)坐标系的**原点（CO）**固定在机器人上，一般选择船中部的水线中点为原点，坐标轴一般与惯性重合，选择从船尾到船头的纵向直线为x轴，右舷横向为y轴，顶部与底部连线为z轴。

​	🚩在BODY上通常定义一些关键的参考点，CG(重心)、CB(浮心)、**CF(漂心)**。其中CF是在温暖水域中水线面的中心，运动过程中roll、pitch将以CF为中心运动，因此CF通常用于计算roll与pitch的周期。CF与CO之间的距离称为LCF。六自由度运动方程的特征值独立于参考点，但是如果不以CF作为计算原点，解耦的方程将会得到错误的结构。

#### 2.1.3 运动定义

​	根据SNAME的定义，使用1.4中说明的符号定义方法：

![c8208b887194e4b6baec6317dd3f8a1](https://gitee.com/airporal/image_hub/raw/master/img/202505212050752.jpg)

​	水下航行器的六自由度运动可以表示为：
$$
\eta=
\begin{bmatrix}
\boldsymbol{p}_{b/n}^n(\mathrm{or}\boldsymbol{p}_{b/e}^e) \\
\boldsymbol{\Theta}_{nb}
\end{bmatrix},\quad\boldsymbol{\nu}=
\begin{bmatrix}
\boldsymbol{v}_{b/n}^b \\
\boldsymbol{\omega}_{b/n}^b
\end{bmatrix},\quad\boldsymbol{\tau}=
\begin{bmatrix}
\boldsymbol{f}_b^b \\
\boldsymbol{m}_b^b
\end{bmatrix}
$$
​	其中$\eta\in \mathbb{R}^3\times\mathit{S}^3$是三自由度的位置与三自由度的姿态向量，局部导航时，航行器的位置一般定义为b系相对于n系的位置与欧拉角并在b系下表示（将具备看成平面），在全球导航时，将位置表示为b系相对于ECEF坐标系的位置并在e系下表示更方便；航行器的姿态一般使用欧拉角($\mathit{S}^3$)或者四元数表示($\mathbb{R}^4$)。$\nu\in \mathbb{R}^6$是六自由度的加速度矢量。$\tau\in\mathbb{R}^6$表示作用在航行器上的力与力矩在b系下的表示。

### 2.2 Body与NED的转换

#### 2.2.1 常用定义

​	由于旋转矩阵$R\in SO(3)$是正交的，因此逆旋转矩阵为：
$$
R^{-1}=R^T
$$
​	通过旋转矩阵，可以将向量转换到另一个坐标系：
$$
v^{to}=R^{to}_{from}v^{from}
$$
​	在导航、控制中常用的旋转矩阵是n系和b系的旋转矩阵$R^n_b$，在计算旋转矩阵时，需要用到以下定义：

+ **反对称阵**

​	满足$S=-S^T$的矩阵称为反对称阵。

+ **向量叉乘**

​	定义向量叉乘为$\lambda\times a :=S(\lambda)a$，其中：
$$
S(\lambda)=-S^{\top}(\lambda)=
\begin{bmatrix}
0 & -\lambda_3 & \lambda_2 \\
\lambda_3 & 0 & -\lambda_1 \\
-\lambda_2 & \lambda_1 & 0
\end{bmatrix},\quad\lambda=
\begin{bmatrix}
\lambda_1 \\
\lambda_2 \\
\lambda_3
\end{bmatrix}
$$

​	且满足以下关系：
$$
S^T(a)b=-S(a)b=S(b)a
$$

​		这个定义是李群-李代数对特殊正交群SO3的定义。SO(3)对应的李代数是定义在$R^3$上的向量，即$\lambda$。这种变化是为了之后求位置矩阵的导数而建立的。李群-李代数通过将一个满足李群定义的群，如SO(3)，建立与对应的李代数之间的映射关系，通过BCH对李群矩阵形式的加法和李代数的乘法建立联系，最终对位姿变化矩阵进行求导。




+ **简单旋转**

​	如果两个坐标系或刚体相对于一个坐标系仅绕一个轴进行旋转，则称为简单旋转。

---

​	所有的旋转变换都可以用一些列的简单旋转得到：

​	b系绕n系旋转$\beta$角度，旋转轴的方向向量为$\boldsymbol{\lambda}=[\lambda_1,\lambda_2,\lambda_3]^T$,且$||\lambda||=1$，则旋转定义为：
$$
v_{b/n}^{n}=R_{b}^{n}v_{b/n}^{b},\ \ \ \ R_{b}^{n}:=R_{ \lambda, \beta}
$$
​	b系到n系的旋转矩阵可以由旋转轴与旋转角度计算得到：
$$
{R}_{\lambda,\beta}= {I}_{3\times 3}+\sin( \beta) {S}( {\lambda})+\left[1-\cos(\beta) \right] {S}^{2}( {\lambda})
$$
​	其中$S(\lambda)$是向量$\lambda$的元素组成的反对称阵，计算可得到$S^2(\lambda)=\lambda\lambda^T-I_{3\times3}$。将旋转矩阵展开得：
$$
\begin{split} R_{11}&=\left[1-\cos(\beta)\right] \lambda_{1}^{2}+\cos(\beta)\\ R_{22}&=\left[1-\cos(\beta)\right]\lambda_{2}^{2}+ \cos(\beta)\\ R_{33}&=\left[1-\cos(\beta)\right]\lambda_{3}^{2}+ \cos(\beta)\\ R_{12}&=\left[1-\cos(\beta)\right]\lambda_{1} \lambda_{2}-\lambda_{3}\sin(\beta)\\ R_{21}&=\left[1-\cos(\beta)\right]\lambda_{2} \lambda_{1}+\lambda_{3}\sin(\beta)\\ R_{23}&=\left[1-\cos(\beta)\right]\lambda_{2} \lambda_{3}-\lambda_{1}\sin(\beta)\\ R_{32}&=\left[1-\cos(\beta)\right]\lambda_{3} \lambda_{2}+\lambda_{1}\sin(\beta)\\ R_{31}&=\left[1-\cos(\beta)\right]\lambda_{3} \lambda_{1}-\lambda_{2}\sin(\beta)\\ R_{13}&=\left[1-\cos(\beta)\right]\lambda_{1} \lambda_{3}+\lambda_{2}\sin(\beta)\end{split}
$$

---

#### 2.2.2 旋转矩阵

​	使用欧拉角(roll$\phi$、pitch$\theta$、yaw$\psi$)将body坐标系下的速度转化为NED坐标系下：
$$
R_b^n(\Theta_{nb}):\mathit{S}^3\rightarrow SO(3)\\v_{b/n}^n=R_b^n(\Theta_{nb})v_{b/n}^b
$$
​	对于仅仅沿着各个坐标轴的简单旋转，有以下三种简单场景：
$$
\left.R_{x,\phi}=\left[
\begin{array}
{ccc}1 & 0 & 0 \\
0 & c\phi & -s\phi \\
0 & s\phi & c\phi
\end{array}\right.\right],R_{y,\theta}=
\begin{bmatrix}
c\theta & 0 & s\theta \\
0 & 1 & 0 \\
-s\theta & 0 & c\theta
\end{bmatrix},R_{z,\psi}=
\begin{bmatrix}
c\psi & -s\psi & 0 \\
s\psi & c\psi & 0 \\
0 & 0 & 1
\end{bmatrix}
$$
​	从b系到n系的坐标转换矩阵通常使用zyx公约描述，即：
$$
R_b^n(\Theta_{nb}):=R_{z,\psi}R_{y,\theta}R_{x,\phi}
$$
​	由于旋转矩阵是正交阵，得到从n系到b系的坐标旋转矩阵为：
$$
R_b^n(\Theta_{nb})^{-1}=R_n^b(\Theta_{nb})=R_b^n(\Theta_{nb})^{T}=R_{x,\phi}^TR_{y,\theta}^TR_{z,\psi}^T
$$
​	最终得到旋转矩阵为：
$$
R_{b}^{n}\left(\Theta_{nb}\right)=
\begin{bmatrix}
c\psi c\theta & -s\psi c\phi+c\psi s\theta s\phi & s\psi s\phi+c\psi c\phi s\theta \\
s\psi c\theta & c\psi c\phi+s\phi s\theta s\psi & -c\psi s\phi+s\theta s\psi c\phi \\
-s\theta & c\theta s\phi & c\theta c\phi
\end{bmatrix}
$$
​	整个旋转过程为，开始时b系与n系坐标轴重合，首先绕b系z轴旋转角度$\psi$，然后再绕b系y轴旋转角度$\theta$，最后绕b系x轴旋转$\phi$。

![49a40a6488b963f1c89410a947139af](https://gitee.com/airporal/image_hub/raw/master/img/202505221530212.jpg)

当变化角度很小时，可以近似$cx=1;sx=x$，得到：
$$
\left.R_{b}^{n}(\delta\Theta_{nb})\approx I_{3\times3}+S(\delta\Theta_{nb})=\left[
\begin{array}
{ccc}1 & -\delta\psi & \delta\theta \\
\delta\psi & 1 & -\delta\phi \\
-\delta\theta & \delta\phi & 1
\end{array}\right.\right]
$$

#### 2.2.3 速度转换

​	**body系下刚体的速度转换到n系下位置导数：**
$$
\dot{p}_{b/n}^{n}=R_{b}^{n}(\Theta_{nb})v_{b/n}^{b} 
$$
​	展开得到：
$$
\begin{cases}
 & \dot{N}=u\cos(\psi)\cos(\theta)+v[\cos(\psi)\sin(\theta)\sin(\phi)-\sin(\psi)\cos(\phi)] \\
 &  \qquad+w\left[\sin(\psi)\sin(\phi)+\cos(\psi)\cos(\phi)\sin(\theta)\right] \\
 & \dot{E}=u\sin(\psi)\mathrm{cos}(\theta)+v[\cos(\psi)\cos(\phi)+\sin(\phi)\sin(\theta)\sin(\psi)] \\
 & \qquad+w[\sin(\theta)\sin(\psi)\cos(\phi)-\cos(\psi)\sin(\phi)] \\
 & \dot{D}=-u\sin(\theta)+v\cos(\theta)\sin(\phi)+w\cos(\theta)\cos(\phi)
\end{cases}
$$
​	也可根据n系下测量的位置变化率得到刚体在b系下的速度：
$$
v_{b/n}^{b}=R_{b}^{n}\left(\Theta_{nb}\right)^{-1}\dot{p}_{b/n}^{n}=R_{b}^{n}\left(\Theta_{nb}\right)^{\top}\dot{p}_{b/n}^{n}
$$
​	:rainbow:当进行路径跟踪时，需要再n系下选定指定的路径点，然后结合b系的运动速度对位置进行跟踪控制：
$$
p_{b/n}^{n}(k+1)=p_{b/n}^{n}(k)+hR_{b}^{n}(\Theta_{nb}(k))v_{b/n}^{b}(k)
$$
​	其中k时时间步，h时采样时间间隔。

#### 2.2.4 角速度转换

​	角速度一般也在b系下测量，要转换为使用欧拉角表示的形式：
$$
\dot{\Theta}_{nb}=T_{\Theta}(\Theta_{nb})\omega_{b/n}^{b}
$$
​	其中$\dot{\Theta}_{nb}=[\dot\phi,\dot\theta,\dot\psi]^T$，$\omega_{b/n}^{b}=[p,q,r]^T$。$\omega_{b/n}^{b}$直接积分没有物理含义，并不得到实际的角坐标，${\Theta}_{nb}$才是定义的角坐标。按照2.2.2中定义，$w$测量时在roll没有进行其它变化（最后进行了roll），pitch除了经过b系绕y轴旋转外，还绕x轴进行了额外的旋转，yaw类似进行了y轴、x轴的额外旋转，因此可以得到（即将n到b的旋转矩阵分别应用到各个轴）：
$$
\omega_{b/n}^{b}=
\begin{bmatrix}
\dot{\phi} \\
0 \\
0
\end{bmatrix}+R_{x,\phi}^{T}
\begin{bmatrix}
0 \\
\dot{\theta} \\
0
\end{bmatrix}+R_{x,\phi}^{\top}R_{y,\theta}^{\top}
\begin{bmatrix}
0 \\
0 \\
\dot{\psi}
\end{bmatrix}:=T_{\Theta}^{-1}(\Theta_{nb})\dot{\Theta}_{nb}
$$
​	展开这个旋转矩阵得到：
$$
\left.T_{\Theta}^{-1}\left(\Theta_{nb}\right)=\left[
\begin{array}
{ccc}1 & 0 & -s\theta \\
0 & c\phi & c\theta s\phi \\
0 & -s\phi & c\theta c\phi
\end{array}\right.\right]\quad\Longrightarrow\quad T_{\Theta}\left(\Theta_{nb}\right)=
\begin{bmatrix}
1 & s\phi t\theta & c\phi t\theta \\
0 & c\phi & -s\phi \\
0 & s\phi/c\theta & c\phi/c\theta
\end{bmatrix}
$$
​	将展开的旋转矩阵带入到欧拉角的转换方程中，得到：
$$
\begin{array}{l}
\dot{\phi}=p+q \sin (\phi) \tan (\theta)+r \cos (\phi) \tan (\theta) \\
\dot{\theta}=q \cos (\phi)-r \sin (\phi) \\
\dot{\psi}=q \frac{\sin (\phi)}{\cos (\theta)}+r \frac{\cos (\phi)}{\cos (\theta)}, \quad \theta \neq \pm 90^{\circ}
\end{array}
$$
​	当$ \theta = \pm 90^{\circ}$时，旋转矩阵T不正定，此时不能直接使用上述方法进行角速度转换，对于水面航行器来说并不容易达到这一角度，但是对于水下航行器来说必需考虑这一问题。可以使用两个欧拉角来表示$\theta$，这两个角对应的90°位置不同，因此通过在这两个角度之间切换来避免这一问题。此外，还可以使用四元数来表示角度。

​	当角度比较小的时候，旋转矩阵可以近似为：
$$
\boldsymbol{T}_{\Theta}\left(\delta \Theta_{n b}\right) \approx\left[\begin{array}{ccc}
1 & 0 & \delta \theta \\
0 & 1 & -\delta \phi \\
0 & \delta \phi & 1
\end{array}\right]
$$

---

​	**:bridge_at_night:旋转矩阵微分方程**

​	b系到n系的旋转矩阵微分方程为：
$$
\dot{R}_{b}^{n} = R_{b}^{n} S(\omega_{b/n}^{b})\\
S(\omega_{b/n}^b) = 
\begin{bmatrix}
0 & -r & q \\
r & 0 & -p \\
-q & p & 0
\end{bmatrix}
$$
​	展开得到：
$$
\begin{bmatrix} 
\dot R_{11} & \dot R_{12} & \dot R_{13} \\ 
\dot R_{21} & \dot R_{22} & \dot R_{23} \\ 
\dot R_{31} & \dot R_{23} & \dot R_{33} 
\end{bmatrix} = 
\begin{bmatrix} 
R_{12}r - R_{13}q & -R_{11}r + R_{13}p & R_{11}q - R_{12}p \\ 
R_{22}r - R_{23}q & -R_{21}r + R_{23}p & R_{21}q - R_{22}p \\ 
R_{23}r - R_{33}q & -R_{31}r + R_{33}p & R_{31}q - R_{23}p 
\end{bmatrix}
$$
​	对于小时间内的旋转矩阵变化满足：
$$
R_b^n(t + \Delta t) \approx R_b^n(t) R_b^n(\Delta t)
$$

> [!NOTE]
>
> 旋转矩阵表示的六自由度运动方程：
> $$
> \dot{\eta} = J_\Theta(\eta)v\\
> 
> \Longleftrightarrow
> 
> \begin{bmatrix}
> \dot{p}_{b/n}^n \\
> \dot{\Theta}_{nb}
> \end{bmatrix}
> =
> \begin{bmatrix}
> R_b^n(\Theta_{nb}) & 0_{3 \times 3} \\
> 0_{3 \times 3} & T_\Theta(\Theta_{nb})
> \end{bmatrix}
> \begin{bmatrix}
> v_{b/n}^b \\
> \omega_{b/n}^b
> \end{bmatrix}
> $$
> 速度与角速度都是固定在刚体上的IMU测得，因此都是相对于b系；位置与欧拉角相对于观测空间评估更为直观，因此都是相对于n系。分量形式：
>
> 

+ 单位四元数

> 四元数表示可以避免欧拉角的奇异值

​	四元数由一个实部和三个虚部组成，单位四元数的集合Q定义为：
$$
Q := \{ \boldsymbol{q} | \boldsymbol{q}^\top \boldsymbol{q} = 1, \boldsymbol{q} = [\eta, \boldsymbol{\varepsilon}^\top]^\top, \quad \boldsymbol{\varepsilon} \in \mathbb{R}^3 \text{ and } \eta \in \mathbb{R} \}
$$
​	对于绕轴$\boldsymbol{\lambda}$旋转$\beta$角度的变换，可以用单位四元数表示为：
$$
\eta := \cos \left( \frac{\beta}{2} \right)
\\


\boldsymbol{\varepsilon} = [\varepsilon_1, \varepsilon_2, \varepsilon_3]^\top := \boldsymbol{\lambda} \sin \left( \frac{\beta}{2} \right)\\

q = 
\begin{bmatrix}
\eta \\
\varepsilon_1 \\
\varepsilon_2 \\
\varepsilon_3
\end{bmatrix} =
\begin{bmatrix}
\cos\left(\frac{\beta}{2}\right) \\
\boldsymbol{\lambda} \sin\left(\frac{\beta}{2}\right)
\end{bmatrix} \in Q, \quad 0 \leq \beta \leq 2\pi
$$
​	其中：
$$
\boldsymbol{\lambda} = \pm \frac{\boldsymbol{\varepsilon}}{\sqrt{\boldsymbol{\varepsilon}^T \boldsymbol{\varepsilon}}},\ \ \ \ \ \ 

if \ \ \sqrt{\boldsymbol{\varepsilon}^T \boldsymbol{\varepsilon}} \neq 0\\

\eta^2 + \epsilon_1^2 + \epsilon_2^2 + \epsilon_3^2 = 1
$$
​	则，旋转矩阵可表示为：
$$
R_{b}^{n}(q) := R_{\eta,\epsilon} = I_{3 \times 3} + 2 \eta S(\epsilon) + 2 S^{2}(\epsilon)
$$
​	body系到NED系的速度转换可以表示为：
$$
\dot p_{b/n}^n = R_b^n(q) v_{b/n}^b\\
R_b^n(q) = 
\begin{bmatrix}
1 - 2(\epsilon_2^2 + \epsilon_3^2) & 2(\epsilon_1\epsilon_2 - \epsilon_3\eta) & 2(\epsilon_1\epsilon_3 + \epsilon_2\eta) \\
2(\epsilon_1\epsilon_2 + \epsilon_3\eta) & 1 - 2(\epsilon_1^2 + \epsilon_3^2) & 2(\epsilon_2\epsilon_3 - \epsilon_1\eta) \\
2(\epsilon_1\epsilon_3 - \epsilon_2\eta) & 2(\epsilon_2\epsilon_3 + \epsilon_1\eta) & 1 - 2(\epsilon_1^2 + \epsilon_2^2)
\end{bmatrix}
$$
​	最终得到NED坐标系下对的速度表达：
$$
\dot{N} = u(1 - 2\varepsilon_2^2 - 2\varepsilon_3^2) + 2v(\varepsilon_1\varepsilon_2 - \varepsilon_3\eta) + 2w(\varepsilon_1\varepsilon_3 + \varepsilon_2\eta)
\\
\dot{E} = 2u(\varepsilon_1\varepsilon_2 + \varepsilon_3\eta) + v(1 - 2\varepsilon_1^2 - 2\varepsilon_3^2) + 2w(\varepsilon_2\varepsilon_3 - \varepsilon_1\eta)
\\


\dot{D} = 2u(\varepsilon_1\varepsilon_3 - \varepsilon_2\eta) + 2v(\varepsilon_2\varepsilon_3 + \varepsilon_1\eta) + w(1 - 2\varepsilon_1^2 - 2\varepsilon_2^2)
$$
​	用q表示的旋转矩阵也是正交矩阵$R^n_b(q)^{-1}=R^n_b(q)^{T}$。

​	使用单位四元数表示角速度转换时，可以证明以下公式成立：
$$
\dot{q} = T_{q}(q) \omega_{b/n}^{b}\\

T_q(q) = \frac{1}{2}
\begin{bmatrix}
-\varepsilon_1 & -\varepsilon_2 & -\varepsilon_3 \\
\eta & -\varepsilon_3 & \varepsilon_2 \\
\varepsilon_3 & \eta & -\varepsilon_1 \\
-\varepsilon_2 & \varepsilon_1 & \eta
\end{bmatrix},\ \ \ \ \ 


T_q^\top(q) T_q(q) = \frac{1}{4} I_{3 \times 3}
$$
​	此处的四元数定义为b系绕n系以旋转轴$\lambda$旋转$\beta$，和使用欧拉角表示的旋转变化类似，表示的都是n系下的观测，因此，使用四元数表示角速度的变换。展开上述公式为：
$$
\dot{\eta} = -\frac{1}{2}(\varepsilon_1 p + \varepsilon_2 q + \varepsilon_3 r)

\\

\dot{\varepsilon}_1 = \frac{1}{2}(\eta p - \varepsilon_3 q + \varepsilon_2 r)

\\

\dot{\varepsilon}_2 = \frac{1}{2}(\varepsilon_3 p + \eta q - \varepsilon_1 r)

\\

\dot{\varepsilon}_3 = \frac{1}{2}(-\varepsilon_2 p + \varepsilon_1 q + \eta r)
$$
​	用向量表示为：
$$
\dot{\boldsymbol{q}} = 
\begin{bmatrix}
\dot{\eta} \\
\dot{\boldsymbol{\epsilon}}
\end{bmatrix} = \frac{1}{2} 
\begin{bmatrix}
-\boldsymbol{\epsilon}^T \\
\eta \boldsymbol{I}_{3 \times 3} + S(\boldsymbol{\epsilon})
\end{bmatrix} \boldsymbol{w}_{b/n}^b
$$
​	:fire:使用四元数表示欧拉角的状态向量七个自由度：$\boldsymbol{\eta}=[N,E,D,\eta,\epsilon_1,\epsilon_2,\epsilon_3]^T$。六自由度运动方程为：
$$
\dot{\eta} = \boldsymbol{J_q}(\eta) \boldsymbol{\nu}\\



\begin{bmatrix}
\dot{\boldsymbol{p}}_{b/n}^n \\
\dot{\boldsymbol{q}}
\end{bmatrix}
=
\begin{bmatrix}
\boldsymbol{R}_b^n(\boldsymbol{q}) & \boldsymbol{0}_{3 \times 3} \\
\boldsymbol{0}_{4 \times 3} & \boldsymbol{T_q}(\boldsymbol{q})
\end{bmatrix}
\begin{bmatrix}
\boldsymbol{\nu}_{b/n}^b \\
\boldsymbol{\omega}_{b/n}^b
\end{bmatrix}
$$
其中，$\boldsymbol{\eta}\in\mathbb{R}^7$,$\boldsymbol{\nu}\in \mathbb{R}^6$，$\boldsymbol{J_q(\eta)\in\mathbb{R}^{7\times6}}$。

+ 四元数归一化

​	坐标系之间的旋转变化使用的四元数满足单位四元数约束：
$$
\boldsymbol{q^Tq}=\epsilon^2_1+\epsilon^2_2+\epsilon^2_3+\eta=1
$$
​	:a:四元数离散时间归一化

​	根据公式(46)，在离散情况下可以得到：
$$
\boldsymbol{q}(k+1) = \boldsymbol{q}(k) + h \boldsymbol{T_q}(\boldsymbol{q}(k)) \boldsymbol{\omega}_{b/n}^b(k)
$$
​	其中，k代表时间步，h代表采样时间步长。对四元数应用归一化：
$$
\boldsymbol{q}(k+1) = \frac{\boldsymbol{q}(k+1)}{\|\boldsymbol{q}(k+1)\|} = \frac{\boldsymbol{q}(k+1)}{\sqrt{\boldsymbol{q}^T(k+1)\boldsymbol{q}(k+1)}}
$$
​	在程序中计算时，从k=0的初始位置开始，首先使用公式(51)计算下一个时间步的四元数，然后再使用公式(52)进行归一化，得到最终输出的四元数。每一步不断进行迭代。

​	当对公式(46)直接使用连续时间积分时，会出现q长度过大导致数值错误，此时需要使用正则项来避免这类问题：
$$
\dot{\boldsymbol{q}} = \boldsymbol{T_q}(\boldsymbol{q})\boldsymbol{\omega}_{b/n}^b + \frac{\gamma}{2}(1 - \boldsymbol{q}^\top \boldsymbol{q})\boldsymbol{q}
$$
​	:b:已知欧拉角求其四元数

​	在已知欧拉角的情况下，可以写出旋转矩阵，并由旋转矩阵计算得到四元数，具体步骤如下：

​	首先根据公式(25)写出旋转矩阵，并按照以下公式计算得到中间变量$R_4^4$
$$
R_{44} = \text{tr}(\boldsymbol{R}_b^n) = R_{11} + R_{22} + R_{33}
$$
​	然后由以下公式计算$p_i$：
$$
R_{ii} = \max(R_{11}, R_{22}, R_{33}, R_{44})\\

p_i = \left| \sqrt{1 + 2R_{ii} - R_{44}} \right|\\

p_4p_1 = R_{32} - R_{23}
\\

p_2p_3 = R_{32} + R_{23}

\\
p_4p_2 = R_{13} - R_{31}
\\

p_3p_1 = R_{13} + R_{31}
\\

p_4p_3 = R_{21} - R_{12}
\\

p_1p_2 = R_{21} + R_{12}
$$
​	得到四元数$\boldsymbol{q}=[\eta,\epsilon_1,\epsilon_2,\epsilon_3]$：
$$
\epsilon_j=p_j/2 \\
\eta =p4/2
$$
​	:carrot:已知四元数求欧拉角

​	通过四元数得到的旋转矩阵与通过欧拉角得到的旋转矩阵应该相同，因此：
$$
\begin{bmatrix}
c\psi c\theta & -s\psi c\phi + c\psi s\theta s\phi & s\psi s\phi + c\psi s\theta c\phi \\
s\psi c\theta & c\psi c\phi + s\psi s\theta s\phi & -c\psi s\phi + s\psi s\theta c\phi \\
-s\theta & c\theta s\phi & c\theta c\phi
\end{bmatrix}



= 
\begin{bmatrix}
\mathbf{R}_{11} &\mathbf{R}_{12} & \mathbf{R}_{13} \\
\mathbf{R}_{21} &\mathbf{R}_{22} & \mathbf{R}_{23} \\
\mathbf{R}_{31} &\mathbf{R}_{32} & \mathbf{R}_{33}
\end{bmatrix}
$$
​	解得欧拉角为：
$$
\boldsymbol{\phi} = \text{atan2}(\mathbf{R}_{32}, \mathbf{R}_{33})
\\
\boldsymbol{\theta} = -\sin^{-1}(\mathbf{R}_{31}) = -\tan^{-1} \left( \frac{\mathbf{R}_{31}}{\sqrt{1 - \mathbf{R}_{31}^2}} \right); \quad \boldsymbol{\theta} \neq \pm 90^\circ
\\
\boldsymbol{\psi} = \text{atan2}(\mathbf{R}_{21}, \mathbf{R}_{11}); \quad -\pi\leq atan2(y,x)\leq\pi
$$
​	要注意欧拉角的奇异值处理。

### 2.3 ECEF与NED的转换 

​	在进行全球卫星导航时，需要使用ECEF系，ECEF系由NED系旋转而来，分为两个主要旋转：

+ 绕着z轴旋转$l$，即经度
+ 绕着y轴旋转$-u-\pi/2$得到纬度。

$$
\dot{\mathbf{p}}_{b/e}^e = \mathbf{R}_n^e(\boldsymbol{\Theta}_{en}) \dot{\mathbf{p}}_{b/e}^n = \mathbf{R}_n^e(\boldsymbol{\Theta}_{en}) \mathbf{R}_b^n(\boldsymbol{\Theta}_{nb}) \mathbf{v}_{b/e}^b
$$

​	其中，$\Theta_{en}=[l,u]^T\in S^2$，旋转变化$\boldsymbol{R^e_n}(\Theta_{en}):S^2\rightarrow SO(3)$。	
$$
\mathbf{R}_n^e(\boldsymbol{\Theta}_{en}) = \mathbf{R}_{z,l} \mathbf{R}_{y,-\mu-\frac{\pi}{2}}
\\=
\begin{bmatrix}
\cos(l) & -\sin(l) & 0 \\
\sin(l) & \cos(l) & 0 \\
0 & 0 & 1
\end{bmatrix}
\begin{bmatrix}
\cos\left(-\mu-\frac{\pi}{2}\right) & 0 & \sin\left(-\mu-\frac{\pi}{2}\right) \\
0 & 1 & 0 \\
-\sin\left(-\mu-\frac{\pi}{2}\right) & 0 & \cos\left(-\mu-\frac{\pi}{2}\right)
\end{bmatrix}
$$
​	整理得到：
$$
\mathbf{R}_n^e(\boldsymbol{\Theta}_{en}) = 
\begin{bmatrix}
-\cos(l) \sin(\mu) & -\sin(l) & -\cos(l) \cos(\mu) \\
-\sin(l) \sin(\mu) & \cos(l) & -\sin(l) \cos(\mu) \\
\cos(\mu) & 0 & -\sin(\mu)
\end{bmatrix}
$$
​	:ship:对于航行器在地球表面局部的运动导航，纬度与经度几乎不变，此时旋转矩阵(61)为常量，则：
$$
\mathbf{R}_n^e(\boldsymbol{\Theta}_{en}) = \mathbf{R}_o = \text{constant}
\\

\dot{\mathbf{p}}_{b/e} = \mathbf{R}_o \mathbf{R}_b^n(\boldsymbol{\Theta}_{nb}) \mathbf{v}_{b/e}^b
$$
​	![image-20250525153036973](https://gitee.com/airporal/image_hub/raw/master/img/202505251530398.png)

​	通常将地球考虑为一个椭圆，椭圆截面如上图所示。椭圆的参数定义如下：
$$
r_e=6378137m,\ \ \ r_p=6356752m\\
w_e=7.292115\times 10^{-5}rad/s,\ \ \ e=0.0818\\
N=\frac{r_e^2}{\sqrt{r_e^2cos^2(\mu)+r_p^2sin^2(\mu)}}\\
l=atan(\frac{y}{x}),\ \ \ tan(\mu)=\frac{z}{p}(1-e^2\frac{N}{N+h})^{-1}\\
h=\frac{p}{cos(\mu)}-N,\ \ \ \ \ e=\sqrt{1-(\frac{r_p}{r_e})^2}
$$

+ $\boldsymbol{p}^e_{b/e}=[x,y,z]^T$转换为$[l,u,h]^T$

​	由航行器在ECEF坐标系下的坐标可以计算得到经纬度和高度：

​	:one:计算纬度：
$$
p = \sqrt{x^2+y^2}, \ \ \ \ \mu_0=arctan(\frac{z}{p}(1-e^2)^{-1})
$$
​	:two:计算h值：
$$
N=\frac{r^2_e}{\sqrt{r^2_ecos^2(\mu_{0})+r^2_psin^2(\mu_{0})}},\ \ \ h=\frac{p}{cos(\mu_0)}-N_0
$$
​	:three:迭代计算新的纬度：
$$
 tan(\mu)=\frac{z}{p}(1-e^2\frac{N_0}{N_0+h})^{-1}\\
$$
​	:four:判断是否收敛:
$$
if\ \ |\mu-\mu_0|<tol,则结束迭代；\\
else:\mu_0=\mu,重新进行第二步。
$$

> [!IMPORTANT]
>
> body系的原点在ECEF系下的坐标与经度纬度高度转换：
> $$
> \begin{bmatrix} 
> \mathbf{x} \\ 
> \mathbf{y} \\ 
> \mathbf{z} 
> \end{bmatrix} = 
> \begin{bmatrix} 
> (N + h) \cos(\boldsymbol{\mu}) \cos(\boldsymbol{l}) \\ 
> (N + h) \cos(\boldsymbol{\mu}) \sin(\boldsymbol{l}) \\ 
> \left( \frac{r_p^2}{r_e^2} N + h \right) \sin(\boldsymbol{\mu}) 
> \end{bmatrix}
> $$

### 2.4 BODY与FLOW的转换

​	FLOW 坐标系通常用于表示水动力数据，FLOW坐标系通过旋转BODY坐标系，使得x轴方向与自由流方向一致得到。z轴保持在参考面上并垂直于x轴。y轴通过右手定则确定。

​	在FLOW系下，升力与来流方向垂直，阻力与来流方向平行，航行器速度也与x轴平行，很方便表示。

#### 2.4.1 Course\Heading\Sideslip Angles

​	水平面运动中，常借助航向角、艏向角、偏航角来进行航行器的运动控制与导航。

![a4f84a1790a0392ebafc6d2c47b568f](https://gitee.com/airporal/image_hub/raw/master/img/202505251735656.jpg)

​	在水平面上运动的航行器，速度为$U=\sqrt{u^2+v^2}$，当存在洋流时，速度变为：
$$
U_r=\sqrt{(u-u_c)^2+(v-v_c)^2}
$$

+ Course Angle $\chi$航行角

​	航行器速度方向与n系x轴夹角值。以绕z轴正向旋转为正(注意不是航行器朝向)。

+ Heading Angle $\psi$艏向角

​	航行器body坐标系下x轴与n系下x轴的夹角。以绕n系下z轴正向旋转为正。

+ Sideslip Angle$\beta$偏航角

​	航行器body坐标系x轴与航行器速度方向的夹角，以绕b系z轴正方向旋转为正。
$$
\beta=sin^{-1}(\frac{v}{U})\approx\frac{v}{U}
$$
​	三个角度存在以下关系（矢量）：
$$
\chi=\psi+\beta
$$
​	当存在来流时，偏航角可以写成：
$$
\beta_r=sin^{-1}(\frac{v_r}{U_r})\approx\frac{v_r}{U_r},\ \ v_r=v-v_c
$$

---

:heavy_heart_exclamation:当sway 方向的速度v=0且没有来流速度时，由式（70）可知$\beta=0$，则艏向角和航向角相同

:heartbeat:当航行器静止时，$u=v=0$，此时仅受来流速度影响，如果来流速度为$u_c=v_c=0.5$，则根据公式72可以求出偏航角为$\beta_r=sin^{-1}(\frac{-v_c}{\sqrt{u_c^2+v_c^2}})=-0.36\approx-20.7$°。由公式71得到$\chi=\psi-20.7$°

---

#### 2.4.2 Sideslip And Angle of Attack

​	从FLOW到BODY的旋转变化由两个主要旋转完成，首先绕body系的z轴旋转$-\beta$角，得到Stability坐标系，然后，Stability坐标系绕着y轴旋转攻角$\alpha$°：
$$
\mathbf{v}^{\text{stab}} = \mathbf{R}_{y,\boldsymbol{\alpha}} \mathbf{v}^b,

\ \ \ \ \  

\mathbf{v}^{\text{flow}} = \mathbf{R}_{z,-\boldsymbol{\beta}} \mathbf{v}^{\text{stab}}\\
\mathbf{R}_{y, \boldsymbol{\alpha}} = 
\begin{bmatrix}
\cos(\boldsymbol{\alpha}) & 0 & \sin(\boldsymbol{\alpha}) \\
0 & 1 & 0 \\
-\sin(\boldsymbol{\alpha}) & 0 & \cos(\boldsymbol{\alpha})
\end{bmatrix},
\ \ \ 
\mathbf{R}_{z, -\boldsymbol{\beta}} = \mathbf{R}_{z, \boldsymbol{\beta}}^T = 
\begin{bmatrix}
\cos(\boldsymbol{\beta}) & \sin(\boldsymbol{\beta}) & 0 \\
-\sin(\boldsymbol{\beta}) & \cos(\boldsymbol{\beta}) & 0 \\
0 & 0 & 1
\end{bmatrix}
$$
​	对于运动速度大于0的航行器，攻角和偏移角分别为：
$$
\boldsymbol{\alpha} = \tan^{-1} \left( \frac{\mathbf{w}}{\mathbf{u}} \right)

\\

\boldsymbol{\beta} = \sin^{-1} \left( \frac{\mathbf{v}}{U} \right)
$$
​	从BODY系到FLOW系的旋转矩阵为：
$$
\mathbf{R}_b^{\text{flow}} = \mathbf{R}_{z, -\boldsymbol{\beta}} \mathbf{R}_{y, \boldsymbol{\alpha}}



= 
\begin{bmatrix}
\cos(\boldsymbol{\beta}) \cos(\boldsymbol{\alpha}) & \sin(\boldsymbol{\beta}) & \cos(\boldsymbol{\beta}) \sin(\boldsymbol{\alpha}) \\
-\sin(\boldsymbol{\beta}) \cos(\boldsymbol{\alpha}) & \cos(\boldsymbol{\beta}) & -\sin(\boldsymbol{\beta}) \sin(\boldsymbol{\alpha}) \\
-\sin(\boldsymbol{\alpha}) & 0 & \cos(\boldsymbol{\alpha})
\end{bmatrix}
$$
​	从Body系到Flow系的速度变化为：
$$
\mathbf{v}^{\text{flow}} = \mathbf{R}_b^{\text{flow}} \mathbf{v}^b

\\

\mathbf{v}^b = (\mathbf{R}_b^{\text{flow}})^T \mathbf{v}^{\text{flow}}


\\
\begin{bmatrix}
\mathbf{u} \\
\mathbf{v} \\
\mathbf{w}
\end{bmatrix} = \mathbf{R}_{y, \boldsymbol{\alpha}}^T \mathbf{R}_{z, -\boldsymbol{\beta}}^T 
\begin{bmatrix}
U \\
0 \\
0
\end{bmatrix}
$$
​	展开为：
$$
\mathbf{u} = U \cos(\boldsymbol{\alpha}) \cos(\boldsymbol{\beta})
\\


\mathbf{v} = U \sin(\boldsymbol{\beta})
\\


\mathbf{w} = U \sin(\boldsymbol{\alpha}) \cos(\boldsymbol{\beta})
$$
​	当攻角和偏移角较小时:
$$
\mathbf{u} \approx U, \quad \mathbf{v} \approx \boldsymbol{\beta} U, \quad \mathbf{w} \approx \boldsymbol{\alpha} U,\ \ \ 



\boldsymbol{\alpha} \approx \frac{\mathbf{w}}{U}, \quad \boldsymbol{\beta} \approx \frac{\mathbf{v}}{U}
$$
​	在设计路径跟踪控制系统时，通常对速度与偏航角$\beta$进行跟踪控制由公式79得到：
$$
\dot v=Ucos(\beta)\dot\beta,\ \ \ \dot\beta=\frac{1}{Ucos(\beta)}\dot v
$$
​	根据积分公式，可以离散化迭代求解每个时刻的速度与偏航角，进而控制。

> [!CAUTION]
>
> 以上都是不考虑洋流的情况。

+ 洋流情况下的推广

​	在存在洋流的情况下，需要根据Body系下洋流速度计算相对速度:
$$
u_r=u-u_c \\
v_r=v-v_c\\
w_r=w-w_c\\
$$
​	相对的和速度大小为$U_r=\sqrt{u_r^2+v_r^2+w_r^2}$。攻角与偏航角为：
$$
\boldsymbol{\alpha}_r = \tan^{-1} \left( \frac{\mathbf{w}_r}{\mathbf{u}_r} \right);\ \ \ 

\boldsymbol{\beta}_r = \sin^{-1} \left( \frac{\mathbf{v}_r}{U_r} \right)
$$
​	根据式(78)：
$$
\mathbf{u}_r = U_r \cos(\boldsymbol{\alpha}_r) \cos(\boldsymbol{\beta}_r)
\\


\mathbf{v}_r = U_r \sin(\boldsymbol{\beta}_r)


\\
\mathbf{w}_r = U_r \sin(\boldsymbol{\alpha}_r) \cos(\boldsymbol{\beta}_r)
$$
​	当攻角和偏航角很小时：
$$
\mathbf{u_r} \approx U_r, \quad \mathbf{v_r} \approx \boldsymbol{\beta_r} U_r, \quad \mathbf{w_r} \approx \boldsymbol{\alpha_r} U_r,\ \ \ 



\boldsymbol{\alpha_r} \approx \frac{\mathbf{w-w_c}}{U}, \quad \boldsymbol{\beta_r} \approx \frac{\mathbf{v-v_c}}{U}
$$

+ 状态空间转换

​	使用坐标变换矩阵可以将水下航行器在Body系下测量的状态$\boldsymbol v=[u,v,w,p,q,r]^T$转移到Flow系下$\boldsymbol v^{flow}=[U,\beta,\alpha,p,q,r]^T$。

​	对于小角度，可以使用近似的转移变化：
$$
\boldsymbol v^{flow}=T(U)\boldsymbol v\\
T(U)=diag\{1,\frac{1}{U},\frac{1}{U} ，1,1,1\}
$$
​	当U为常数时，其导数为0，则线性动力学模型：
$$
M\dot v+N=\tau \\
\dot v^{flow}=\dot T(U)v+T(U)\dot v=T(U)\dot v
$$
​	转换到Flow坐标系下：
$$
\mathbf{T}(U)\mathbf{M}\mathbf{T}(U)^{-1}\mathbf{\dot v}^{\text{flow}} + \mathbf{T}(U)\mathbf{N}\mathbf{T}(U)^{-1}\mathbf{\dot v}^{\text{flow}} = \mathbf{T}(U)\boldsymbol{\tau}
$$

## 3. 刚体运动学

​	第三章研究的刚体运动学方程的一般形式为：
$$
M_{RB}\boldsymbol{\dot v}+C_{RB}(\boldsymbol v)\boldsymbol{\dot v}=\boldsymbol{\tau_{RB}}
$$
​	其中，M为刚体的惯性矩阵，$\boldsymbol v=[u,v,w,p,q,r]^T $是刚体的速度在body系下的表示，$\boldsymbol {\tau_{RB}}$是刚体受到的六自由度分力在body系下的表示。

![0856c2226bf068e093ccb1a685f4ada](https://gitee.com/airporal/image_hub/raw/master/img/202505271655494.jpg)

### 3.1 关于质心的牛顿-欧拉方程

​	根据牛顿第二定律，惯性系下水下航行器的质心CG加速度$\dot {\overrightarrow{v}}_{g/i}$、质量、重力存在以下关系：
$$
m\dot {\overrightarrow{v}}_{g/i}=\overrightarrow{f}_{g}
$$
​	欧拉定理将牛顿定律扩展到动量和角动量中：
$$
\frac{^id}{dt} \vec{\mathbf{p}}_g = \vec{\mathbf{f}}_g

,\ \ \ \vec{\mathbf{p}}_g = m \vec{\mathbf{v}}_{g/i}\\



\frac{^id}{dt} \vec{\mathbf{h}}_g = \vec{\mathbf{m}}_g
,\ \ \ 
\vec{\mathbf{h}}_g = \mathbf{I}_g \vec{\boldsymbol{\omega}}_{b/i}
$$
​	其中$f_g、m_g$是作用在刚体上CG位置的力与力矩；$p_g、h_g$是刚体运动的动量与角动量；$I_g$是刚体的转动惯量，$\frac{ ^id}{dt}$表示在惯性系下对时间求导。

​	在对水下航行器进行运动建模时，一般假设航行器为刚体，且忽略地球自转，将NED坐标系视为惯性系：
$$
\vec{\mathbf{v}}_{g/i} \approx \vec{\mathbf{v}}_{g/n}\\



\vec{\boldsymbol{\omega}}_{b/i} \approx \vec{\boldsymbol{\omega}}_{b/n}
$$
​	当b系相对于n系运动时，将b系下求导转化为i系下求导，b系下航行器的任意向量（如向量$a$）的导数满足：
$$
\frac{^id}{dt}\vec{\mathbf{a}} = \frac{^bd}{dt}\vec{\mathbf{a}} + \vec{\boldsymbol{\omega}}_{b/i} \times \vec{\mathbf{a}}，\ \ \dot {\overrightarrow{a}}:=\frac{^bd}{dt}\vec{\mathbf{a}}
$$
​	由上式可知，对于水下航行器来说，地球自转角速度极小，所以对加速度的影响可以忽略不计。但是对于大型船舶不可忽略。

​	在i系下，CO、CG存在以下关系：
$$
\vec{\mathbf{r}}_{g/i} = \vec{\mathbf{r}}_{b/i} + \vec{\mathbf{r}}_g
$$
​	参考上面图中的定义，$ \vec{\mathbf{r}}_g$是b系原点CO到重心CG的向量，由于假设n系是i系（忽略自转）：
$$
\vec{\mathbf{r}}_{g/n} = \vec{\mathbf{r}}_{b/n} + \vec{\mathbf{r}}_g
$$
​	根据式（91）,对向量$\vec{\mathbf{r}}_{g/n}$求导：
$$
\vec{\mathbf{v}}_{g/n} = \vec{\mathbf{v}}_{b/n} + \left( \frac{^bd}{dt} \vec{\mathbf{r}}_g + \vec{\boldsymbol{\omega}}_{b/n} \times \vec{\mathbf{r}}_g \right)
$$
​	上式中，速度都是根据n系下的坐标求导得来的，而$\vec{\mathbf{r}}_g$是在body系下的表示。对于刚体：
$$
\frac{^bd}{dt}\vec{\mathbf{r}}_g = \vec{\mathbf{0}}
$$
​	因此：
$$
\vec{\mathbf{v}}_{g/n} = \vec{\mathbf{v}}_{b/n} + \vec{\boldsymbol{\omega}}_{b/n} \times \vec{\mathbf{r}}_g 
$$
​	则式(89)动量定理可以表示为：
$$
\vec{\mathbf{f}}_g = \frac{^id}{dt} (m\vec{\mathbf{v}}_{g/i})
= \frac{^nd}{dt} (m\vec{\mathbf{v}}_{g/n})\\



= \frac{^bd}{dt} (m\vec{\mathbf{v}}_{g/n}) + m\vec{\boldsymbol{\omega}}_{b/n} \times \vec{\mathbf{v}}_{g/n}\\



= m\left(\dot{\vec{\mathbf{v}}}_{g/n} + \vec{\boldsymbol{\omega}}_{b/n} \times \vec{\mathbf{v}}_{g/n}\right)
$$

> 速度、角速度定义在b系下，但是计算的是相对于惯性系的速度，因为相对于刚体固结的body坐标系而言运动静止：
> $$
> m[\dot{\vec{\mathbf{v}}}^b_{g/n} + S(\vec{\boldsymbol{\omega}}^b_{b/n})\vec{\mathbf{v}}^b_{g/n}]=f^b_g
> $$

​	角动量定理可以表示为：
$$
\vec{\mathbf{m}}_g = \frac{^i d}{dt} (\mathbf{I}_g \vec{\boldsymbol{\omega}}_{b/i})= \frac{^n d}{dt} (\mathbf{I}_g \vec{\boldsymbol{\omega}}_{b/n})\\


= \frac{^b d}{dt} (\mathbf{I}_g \vec{\boldsymbol{\omega}}_{b/n}) + \vec{\boldsymbol{\omega}}_{b/n} \times (\mathbf{I}_g \vec{\boldsymbol{\omega}}_{b/n})\\



= \mathbf{I}_g \dot{\vec{\boldsymbol{\omega}}}_{b/n} + \vec{\boldsymbol{\omega}}_{b/n} \times (\mathbf{I}_g \vec{\boldsymbol{\omega}}_{b/n})
$$
​	同样，这些测量都是在b系下：
$$
\mathbf{I}_g \dot{\vec{\boldsymbol{\omega}}}^b_{b/n} +S(\mathbf{I}_g \vec{\boldsymbol{\omega}}^b_{b/n})\vec{\boldsymbol{\omega}}^b_{b/n} \times =m^b_g
$$

---

​	惯性矩阵$I_g\in R^{3\times 3}$基于质心与惯性主轴测量：
$$
\mathbf{I}_g := \begin{bmatrix}
I_x & -I_{xy} & -I_{xz} \\
-I_{yx} & I_y & -I_{yz} \\
-I_{zx} & -I_{zy} & I_z
\end{bmatrix}, \quad \mathbf{I}_g = \mathbf{I}_g^\top > 0
$$
​	其中，$I_x、I_y、I_z$表示关于$x_b,y_b,z_b$的转动惯量，$I_{xy}=I_{yx}、I_{xz}=I_{zx}、I_{zy}=I_{yz}$是惯性积：
$$
I_x = \int_V (y^2 + z^2) \, \rho_m dV;\\



I_y = \int_V (x^2 + z^2) \, \rho_m dV;\\



I_z = \int_V (x^2 + y^2) \, \rho_m dV;\\

I_{xy} = \int_V xy \, \rho_m dV=\int_V yx \, \rho_m dV=I_{yx};\\
I_{xz} = \int_V xz \, \rho_m dV=\int_V zx \, \rho_m dV=I_{zx};\\
I_{zy} = \int_V zy \, \rho_m dV=\int_V yz \, \rho_m dV=I_{yz};\\
$$

> [!IMPORTANT]
>
> 公式（98）和公式（100）用矩阵表示：
> $$
> \mathbf{M}_{RB}^{CG} \begin{bmatrix} \dot{\mathbf{v}}_{g/n}^b \\ \boldsymbol{\dot\omega}_{b/n}^b \end{bmatrix} + \mathbf{C}_{RB}^{CG} \begin{bmatrix} \mathbf{v}_{g/n}^b \\ \boldsymbol{\omega}_{b/n}^b \end{bmatrix} = \begin{bmatrix} \mathbf{f}_g^b \\ \mathbf{m}_g^b \end{bmatrix}
> 
> \\or\\
> 
> \begin{bmatrix}
> m \mathbf{I}_{3 \times 3} & \mathbf{0}_{3 \times 3} \\
> \mathbf{0}_{3 \times 3} & \mathbf{I}_g
> \end{bmatrix} \begin{bmatrix}
> \dot{\mathbf{v}}_{b/n}^b \\ \boldsymbol{\omega}_{b/n}^b 
> \end{bmatrix} + 
> \begin{bmatrix}
> m \mathbf{S}(\boldsymbol{\omega}_{b/n}^b) & \mathbf{0}_{3 \times 3} \\
> \mathbf{0}_{3 \times 3} & -\mathbf{S}(\mathbf{I}_g \boldsymbol{\omega}_{b/n}^b)
> \end{bmatrix} \begin{bmatrix}
> \mathbf{v}_{b/n}^b \\ \boldsymbol{\omega}_{b/n}^b
> \end{bmatrix} = \begin{bmatrix} \mathbf{f}_{b/n}^b \\ \mathbf{m}_{b/n}^b \end{bmatrix}
> $$

### 3.2 关于CO的牛顿-欧拉方程

​	水下航行器的力与力矩一般在CO为原点的body系下计算，3.1节中计算以质心为作用点的运动学方程，本节中推导以CO为力、力矩作用点的牛顿欧拉方程。

​	根据式(96)，在b系下存在：
$$
\mathbf{v}_{g/n}^b = \mathbf{v}_{b/n}^b + \boldsymbol{\omega}_{b/n}^b \times \mathbf{r}_g^b
\\


= \mathbf{v}_{b/n}^b - \mathbf{r}_g^b \times \boldsymbol{\omega}_{b/n}^b


\\
= \mathbf{v}_{b/n}^b + \mathbf{S}^T (\mathbf{r}_g^b) \boldsymbol{\omega}_{b/n}^b
$$
​	因此，CO和CG点相对于n系的速度在b系下的转换关系为：
$$
\begin{bmatrix} 
\mathbf{v}_{g/n}^b \\ 
\boldsymbol{\omega}_{b/n}^b 
\end{bmatrix} = \mathbf{H}(\mathbf{r}_g^b) \begin{bmatrix} 
\mathbf{v}_{b/n}^b \\ 
\boldsymbol{\omega}_{b/n}^b 
\end{bmatrix}
$$
​	其中，$r^b_g=[x_g,y_g,z_g]^T$，$H(r^b_g)\in R^{3\times 3}$是两点速度的旋转矩阵：
$$
\mathbf{H}(\mathbf{r}_g^b) := 
\begin{bmatrix}
\mathbf{I}_{3 \times 3} & \mathbf{S}^T(\mathbf{r}_g^b) \\
\mathbf{0}_{3 \times 3} & \mathbf{I}_{3 \times 3}
\end{bmatrix}, \quad \mathbf{H}^T(\mathbf{r}_g^b) = 
\begin{bmatrix}
\mathbf{I}_{3 \times 3} & \mathbf{0}_{3 \times 3} \\
\mathbf{S}(\mathbf{r}_g^b) & \mathbf{I}_{3 \times 3}
\end{bmatrix}
$$
​	将上式带入到公式(103)中，得到水下航行器关于CO点的运动方程：
$$
\mathbf{H}^T(\mathbf{r}_g^b) \mathbf{M}_{RB}^{CG} \mathbf{H}(\mathbf{r}_g^b) \begin{bmatrix} \dot{\mathbf{v}}_{b/n}^b \\ \dot{\boldsymbol{\omega}}_{b/n}^b \end{bmatrix} + \mathbf{H}^T(\mathbf{r}_g^b) \mathbf{C}_{RB}^{CG} \mathbf{H}(\mathbf{r}_g^b) \begin{bmatrix} \mathbf{v}_{b/n}^b \\ \boldsymbol{\omega}_{b/n}^b \end{bmatrix} = \mathbf{H}^T(\mathbf{r}_g^b) \begin{bmatrix} \mathbf{f}_g^b \\ \mathbf{m}_g^b \end{bmatrix}
$$
​	定义两个新的矩阵$M^{CO}_{RB}:=H^T(r^b_g)M^{CG}_{RB}H(r^b_g)$和$C^{CO}_{RB}:=H^T(r^b_g)C^{CG}_{RB}H(r^b_g)$：
$$
\mathbf{M}_{RB}^{CO} = \begin{bmatrix}
m\mathbf{I}_{3 \times 3} & -m\mathbf{S}(\mathbf{r}_g^b) \\
m\mathbf{S}(\mathbf{r}_g^b) & \mathbf{I}_g - m\mathbf{S}^2(\mathbf{r}_g^b)
\end{bmatrix}
\\\\


\mathbf{C}_{RB}^{CO} = \begin{bmatrix}
m\mathbf{S}(\boldsymbol{\omega}_{b/n}^b) & -m\mathbf{S}(\boldsymbol{\omega}_{b/n}^b)\mathbf{S}(\mathbf{r}_g^b) \\
m\mathbf{S}(\mathbf{r}_g^b)\mathbf{S}(\boldsymbol{\omega}_{b/n}^b) & -\mathbf{S}\left((\mathbf{I}_g - m\mathbf{S}^2(\mathbf{r}_g^b))\boldsymbol{\omega}_{b/n}^b\right)
\end{bmatrix}
$$
​	由式(108、109)可以得到
$$
m\left[\dot{\boldsymbol{v}}_{b/n}^b + \boldsymbol{S}^\top(\boldsymbol{r}_g^b)\dot{\boldsymbol{\omega}}_{b/n}^b + \boldsymbol{S}(\boldsymbol{\omega}_{b/n}^b)\boldsymbol{v}_{b/n}^b + \boldsymbol{S}(\boldsymbol{\omega}_{b/n}^b)\boldsymbol{S}^\top(\boldsymbol{r}_g^b)\boldsymbol{\omega}_{b/n}^b\right] = \boldsymbol{f}_g^b
$$
​	刚体收到外部合力的作用大小并不跟随作用点的变化而变化，只是在不同的点产生不同的力矩。因此$f^b_g=f^b_b$。根据向量叉乘转化为分对称阵的性质，将式(110)转化为CO点的作用力表达形式：
$$
m\left[\dot{\mathbf{v}}_{b/n}^b + \mathbf{S}(\boldsymbol{\dot\omega}_{b/n}^b)\mathbf{r}_g^b + \mathbf{S}(\boldsymbol{\omega}_{b/n}^b)\mathbf{v}_{b/n}^b + \mathbf{S}^2(\boldsymbol{\omega}_{b/n}^b)\mathbf{r}_g^b\right] = \mathbf{f}_b^b\\
or\ \ using\ \ vector-products\\

m\left[\dot{\boldsymbol{v}}_{b/n}^b + \dot{\boldsymbol{\omega}}_{b/n}^b \times \mathbf{r}_g^b + \boldsymbol{\omega}_{b/n}^b \times \mathbf{v}_{b/n}^b + \boldsymbol{\omega}_{b/n}^b \times (\boldsymbol{\omega}_{b/n}^b \times \mathbf{r}_g^b)\right] = \mathbf{f}_b^b
$$

+ 平行轴理论

​	惯性矩阵是以质心CG为作用点建立的，现在需要建立在CO为作用点的运动方程，因此需要使用**<font color=red>平行轴理论</font>**，将惯性矩阵转化为CO为作用点：
$$
\mathbf{I}_b = \mathbf{I}_g - m \mathbf{S}^2(\mathbf{r}_g^b) = \mathbf{I}_g - m \left( \mathbf{r}_g^b (\mathbf{r}_g^b)^\top - (\mathbf{r}_g^b)^\top \mathbf{r}_g^b \, \mathbf{I}_{3 \times 3} \right)
$$
其中，$I_b、I_g\in R^{3\times 3},且I_b=I^T_b，I_g=I^T_g$。

​	利用平行轴理论，可以得到
$$
\mathbf{I}_b \dot{\boldsymbol{\omega}}_{b/n}^b + \mathbf{S}(\boldsymbol{\omega}_{b/n}^b) \mathbf{I}_b \boldsymbol{\omega}_{b/n}^b + m \mathbf{S}(\mathbf{r}_g^b) \dot{\mathbf{v}}_{b/n}^b + m \mathbf{S}(\mathbf{r}_g^b) \mathbf{S}(\boldsymbol{\omega}_{b/n}^b) \mathbf{v}_{b/n}^b = \mathbf{m}_b^b
\\ or\ \ vector-products\\

\mathbf{I}_b \dot{\boldsymbol{\omega}}_{b/n}^b + \boldsymbol{\omega}_{b/n}^b \times \mathbf{I}_b \boldsymbol{\omega}_{b/n}^b + m \mathbf{r}_g^b \times \left( \dot{\mathbf{v}}_{b/n}^b + \boldsymbol{\omega}_{b/n}^b \times \mathbf{v}_{b/n}^b \right) = \mathbf{m}_b^b
$$

### 3.3 刚体运动方程

​	将3.2节推导的公式(111)和(113)展开到分量形式，就是公式(3)，即：
$$
\begin{aligned}
 & X=m\left[\dot{u}-vr+wq-x_{g}\left(q^{2}+r^{2}\right)+y_{g}\left(pq-\dot{r}\right)+z_{g}\left(pr+\dot{q}\right)\right] \\
 & Y=m\left[\dot{v}-wp+ur-y_{g}\left(r^{2}+p^{2}\right)+z_{g}\left(qr-\dot{p}\right)+x_{g}\left(qp+\dot{r}\right)\right] \\
 & Z=m\left[\dot{w}-uq+vp-z_{g}\left(p^{2}+q^{2}\right)+x_{g}\left(rp-\dot{q}\right)+y_{g}\left(rq+\dot{p}\right)\right] \\
 & K=I_{x}\dot{p}+(I_{z}-I_{y})qr-(\dot{r}+pq)I_{xz}+(r^{2}-q^{2})I_{yz}+(pr-\dot{q})I_{xy} \\
 &\qquad+m\left[y_{g}\left(\dot{w}-uq+vp\right)-z_{g}\left(\dot{v}-wp+ur\right)\right] \\
 & M=I_{y}\dot{q}+(I_{x}-I_{z})rp-(\dot{p}+qr)I_{xy}+(p^{2}-r^{2})I_{zx}+(qp-\dot{r})I_{yz} \\
 & \qquad+m\left[z_{g}\left(\dot{u}-vr+wq\right)-x_{g}\left(\dot{w}-uq+vp\right)\right] \\
 & N=I_{z}\dot{r}+(I_{y}-I_{x})pq-(\dot{q}+rp)I_{yz}+(q^{2}-p^{2})I_{xy}+(rq-\dot{p})I_{zx} \\
 & \qquad+m\left[x_{g}\left(\dot{v}-wp+ur\right)-y_{g}\left(\dot{u}-vr+wq\right)\right]
\end{aligned}
$$
​	将展开式整理到向量形式：
$$
\mathbf{M}_{RB} \mathbf{\dot v} + \mathbf{C}_{RB}(\mathbf{v}) \mathbf{v} = \boldsymbol{\tau}_{RB}
$$
​	其中$\boldsymbol v=[u,v,w,p,q,r]^T$是刚体相对于n系运动的速度在b系下的向量。$\boldsymbol{\tau}_{RB}=[X,Y,Z,K,M,N]^T$是外力与外力矩的向量。

+ 性质一：惯性矩阵$M_{RB}$性质

​	这里的惯性矩阵是对整个惯性系统的整体表示，而不仅仅是上节中的I。
$$
\mathbf{M}_{RB} = 
\begin{bmatrix}
m \mathbf{I}_{3 \times 3} & -m \mathbf{S}(\mathbf{r}_g^b) \\
m \mathbf{S}(\mathbf{r}_g^b) & \mathbf{I}_b
\end{bmatrix}

\\

= 
\begin{bmatrix}
m & 0 & 0 & 0 & m z_g & -m y_g \\
0 & m & 0 & -m z_g & 0 & m x_g \\
0 & 0 & m & m y_g & -m x_g & 0 \\
0 & -m z_g & m y_g & I_x & -I_{xy} & -I_{xz} \\
m z_g & 0 & -m x_g & -I_{yx} & I_y & -I_{yz} \\
-m y_g & m x_g & 0 & -I_{zx} & -I_{zy} & I_z
\end{bmatrix}
$$
​	上式中，$S(r^b_g)$是反对称阵，$I_{3\times 3}$是单位矩阵，$I_b和M_{RB}$正定且对称：
$$
M_{RB}=M^T_{RB}>0\ \ \ \dot M_{RB}=0_{6\times 6}\\I_b=I_b^T>0
$$

+ 性质二：科氏力—向心力矩阵

​	$C_{RB}$是科氏力向量$w^b_{b/n}\times v^b_{b/n}$和向心力向量$w^b_{b/n}\times (w^b_{b/n} \times r^b_g)$。将式(116)中的惯性矩阵表示为：
$$
\mathbf{M} = \mathbf{M}^T = 
\begin{bmatrix} 
\mathbf{M}_{11} & \mathbf{M}_{12} \\ 
\mathbf{M}_{21} & \mathbf{M}_{22} 
\end{bmatrix} > 0
$$
​	则科氏力可以表示为：
$$
\mathbf{C}(\mathbf{v}) = 
\begin{bmatrix}
\mathbf{0}_{3 \times 3} & -\mathbf{S}(\mathbf{M}_{11}\mathbf{v}_1 + \mathbf{M}_{12}\mathbf{v}_2) \\
-\mathbf{S}(\mathbf{M}_{11}\mathbf{v}_1 + \mathbf{M}_{12}\mathbf{v}_2) & -\mathbf{S}(\mathbf{M}_{21}\mathbf{v}_1 + \mathbf{M}_{22}\mathbf{v}_2)
\end{bmatrix}
$$
​	其中，$v_1=[u,v,w]^T,v_2=[p,q,r]^T$。**采样适当的惯性矩阵表示方法可以得到反对称的科氏力-向心力矩阵，这对控制系统设计具有极好的作用:**
$$
C_{RB}(v)=-C^T_{RB}(v),v\in R^6
$$
​	当将惯性矩阵表示为上述的$M_{RB}$形式时：
$$
\mathbf{C}_{RB}(\mathbf{v}) = 
\begin{bmatrix} 
\mathbf{0}_{3 \times 3} & -m\mathbf{S}(\mathbf{v}_1) - m\mathbf{S}(\mathbf{S}(\mathbf{v}_2)\mathbf{r}_g^b) \\ 
-m\mathbf{S}(\mathbf{v}_1) - m\mathbf{S}(\mathbf{S}(\mathbf{v}_2)\mathbf{r}_g^b) & m\mathbf{S}(\mathbf{S}(\mathbf{v}_1)\mathbf{r}_g^b) - \mathbf{S}(\mathbf{I}_b \mathbf{v}_2) 
\end{bmatrix}
$$
​	当满足$S(v_1)v_1=0$时满足公式(120)。展开为分量形式：
$$
\mathbf{C}_{RB}(\mathbf{v}) = 
\begin{bmatrix}
0 & 0 & 0 & m(y_gq+z_gr) & -m(x_gq-w) & -m(x_gr+v) \\
0 & 0 & 0 & -m(y_gp+w)&m(z_gr+x_gp)&-m(y_gr-u) \\
0 & 0 & 0 & -m(z_gp-v)&-m(z_gq+u)&m(x_gp+y_gq) \\
-m(y_gq+z_gr) & m(y_gp+w) & m(z_gp-v) & 0 & -I_{yz}q-I_{xz}p+I_zr & I_{yz}r+I_{xy}p-I_yq \\
m(x_gq-w) & -m(z_gr+x_gp) & m(z_gq+u) & I_{yz}q+I_{xz}p-I_zr&0& -I_{xz}r-I_{xy}q+I_xp\\
m(x_gr+v) & m(y_gr-u) & -m(x_gp+y_gq) & -I_{yz}r-I_{xy}p+I_yq&I_{xz}r+I_{xy}q-I_xp&0 \\
\end{bmatrix}
$$
​	👍当使用$S(v_1)v_2=-S(v_2)v_1$时，科氏力还可以表示为：
$$
\mathbf{C}_{RB}(\mathbf{v}) = 
\begin{bmatrix}
m\mathbf{S}(\mathbf{v}_2) & -m\mathbf{S}(\mathbf{v}_2)\mathbf{S}(\mathbf{r}_g^b) \\
m\mathbf{S}(\mathbf{r}_g^b)\mathbf{S}(\mathbf{v}_2) & -\mathbf{S}(\mathbf{I}_b \mathbf{v}_2)
\end{bmatrix}
$$
​	这种表达使得科氏力-向心力表示仅仅依赖角速度如不需要速度，对于水下航行器在无旋流中运动时方便。

---

+ 刚体六自由度线性运动方程

​	当水下航行器以前向速度$v=[U,0,0,0,0,0]^T$运动时，公式(115)可以表示为：
$$
\mathbf{M}_{RB} \mathbf{\dot v} + \mathbf{C}^*_{RB}(\mathbf{v}) \mathbf{v} = \boldsymbol{\tau}_{RB}
$$
​	其中：
$$
\mathbf{C}_{RB}^* = \mathbf{M}_{RB} \mathbf{L} \mathbf{U}\\

\mathbf{L} = 
\begin{bmatrix}
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & \mathbf{1} \\
0 & 0 & 0 & 0 & -\mathbf{1} & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0
\end{bmatrix}
$$
​	$L$是一个选择矩阵。收到的科氏力-向心力向量为：
$$
\mathbf{f_c} = \mathbf{C_R^*} \mathbf{v} = 
\begin{bmatrix}
0 \\ mUr\\
-mUq \\
-my_gUq - mUr \\
mx_gUq \\
mx_gUr
\end{bmatrix}
$$

---

​	通过选择合适的CO可以简化刚体六自由度运动方程，可以选择一下几种简化方法：

+ 选择CG作为CO：

  此时$\boldsymbol r^b_[0,0,0]^T,I_b=I_g$，且：
  $$
  \mathbf{M_{RB}} = 
  \begin{bmatrix}
  m\mathbf{I_{3 \times 3}} & \mathbf{0_{3 \times 3}} \\ 
  \mathbf{0_{3 \times 3}} & \mathbf{I_g}
  \end{bmatrix}
  $$
  当惯性主轴和body系坐标轴重合时，可以进一步简化：$I_g=diag\{I^{cg}_x,I^{cg}_y,I^{cg}_z\}$
  
+ 饶CO旋转坐标系，使得$I_b$成为对角阵

  设置body系坐标轴时，可以选择与惯性主轴、刚体对称轴重合，使得惯性矩阵成为一个对角阵$I_b=diag\{I_x,I_y,I_z\}$，再通过平行轴理论：
  $$
  \mathbf{I_x} = \mathbf{I_x^{cg}} + m(\mathbf{y^2_g} + \mathbf{z^2_g})
  \\
  \mathbf{I_y} = \mathbf{I_y^{cg}} + m(\mathbf{x^2_g} + \mathbf{z^2_g})
  \\
  \mathbf{I_z} = \mathbf{I_z^{cg}} + m(\mathbf{x^2_g} + \mathbf{y^2_g})
  $$
  且重心满足：
  $$
  m I_{yz}^{cg} x_g^2 = -I_{xy}^{cg} I_{xz}^{cg}
  \\
  m I_{xz}^{cg} y_g^2 = -I_{xy}^{cg} I_{yz}^{cg}
  \\
  m I_{xy}^{cg} z_g^2 = I_{xz}^{cg} I_{yz}^{cg}
  $$
  则六自由度运动方程(3)简化为：
  $$
  m\left[ \dot{u} - vr + wq - x_g (q^2 + r^2) + y_g (pq - \dot{r}) + z_g (pr + \dot{q}) \right] = X\\
  
  m\left[ \dot{v} - wp + ur - y_g (r^2 + p^2) + z_g (qr - \dot{p}) + x_g (qp + \dot{r}) \right] = Y\\
  
  m\left[ \dot{w} - uq + vp - z_g (p^2 + q^2) + x_g (rp - \dot{q}) + y_g (rq + \dot{p}) \right] = Z\\
  
  I_x \dot{p} + (I_z - I_y) qr + m \left[ y_g (\dot{w} - uq + vp) - z_g (\dot{v} - wp + ur) \right] = K\\
  I_y \dot{q} + (I_x - I_z) rp + m \left[ z_g (\dot{u} - vr + wq) - x_g (\dot{w} - uq + vp) \right] = M\\
  
  I_z \dot{r} + (I_y - I_x) pq + m \left[ x_g (\dot{v} - wp + ur) - y_g (\dot{u} - vr + wq) \right] = N
  $$
  
+ 

## 4. 静水力(Hydrostatics)

​	静水力中，重力和浮力被称为恢复力，相当于质量-阻尼-弹性系统中的弹性部分，对于恢复力，水下航行器和水面舰艇存在区别。

​	水下航行器的恢复力由排水体积、浮心CB位置、水面面积以及相关力矩决定，

### 4.1 水下航行器恢复力

​	水下航行器的重力、浮力分别作用于重心CG、浮心CB，相对于Body坐标系的原点CO而言，分别表示为：$f^b_g,f^b_b,r^b_g=[x_g,y_g,z_g]^T,r^b_b=[x_b,y_b,z_b]^T$。

​	水下航行器的重力与浮力为：
$$
W=mg\ \ \ \ B=\rho g \nabla
$$
​	其中$m$是水下航行器及其内部的水的质量，$\nabla$是水下航行器排开水的体积。恢复力作用于n系下的垂直平面，因此用向量表示为：
$$
f^n_g=\begin{bmatrix}
0\\0\\W
\end{bmatrix},\ \ \ \ 
f^n_b=-\begin{bmatrix}
0\\0\\B
\end{bmatrix}
$$
​	

### 4.2 Load Condition and Natural Periods

#### 4.2.1 自然周期解耦计算

​	负载与质量分布影响水下航行器的heavy、roll、pitch自然周期，对线性系统而言，由于相似变化不会改变六自由度表示的运动方程的特征值，这三种运动的自然周期不会随坐标原点的改变而变化。但是，由于水动力系数与波浪的频率相关，使得系统并不能保持非线性。
$$
[m + A_{33}(\omega_{\text{heave}})] \dot{z} + B_{33}(\omega_{\text{heave}}) w + C_{33} z = 0
\\
[I_x + A_{44}(\omega_{\text{roll}})] \dot{p} + B_{44}(\omega_{\text{roll}}) p + C_{44} \phi = 0
\\
[I_y + A_{55}(\omega_{\text{pitch}})] \dot{q} + B_{55}(\omega_{\text{pitch}}) q + C_{55} \theta = 0
$$
​	上式中的系数$A_{ii},B_{ii},C_{ii},I_x,I_y$都是相对于roll和pitch的旋转中心，即CF(漂心，center of flotation)计算的。存在耦合时，旋转中心和旋转轴将会改变。如果CF未知，通常使用CO近似替代CF，CO和CF之间的距离仅为body系上x轴偏移，记为LCF，这种近似会对pitch运动周期产生影响，当LCF比较小时影响不敏感。但是如果近似点与CF距离很远，再使用上式的解耦方程会出错，因为上式方程组特征值会变。

​	式(141)中相对于CF的自然周期，可以使用以下隐式函数计算：
$$
\omega_{\text{heave}} = \sqrt{\frac{C_{33}}{m + A_{33}(\omega_{\text{heave}})}}, \quad T_{\text{heave}} = \frac{2\pi}{\omega_{\text{heave}}}
\\


\omega_{\text{roll}} = \sqrt{\frac{C_{44}}{I_x + A_{44}(\omega_{\text{roll}})}}, \quad T_{\text{roll}} = \frac{2\pi}{\omega_{\text{roll}}}
\\


\omega_{\text{pitch}} = \sqrt{\frac{C_{55}}{I_y + A_{55}(\omega_{\text{pitch}})}}, \quad T_{\text{pitch}} = \frac{2\pi}{\omega_{\text{pitch}}}
$$
​	上式隐式函数使用**牛顿迭代法**计算。

> [!CAUTION]
>
> **牛顿迭代法**求解隐式函数的根：
>
> + 首先构造目标函数：
>
> $$
> f(w_n)=w_n-\sqrt{\frac{C}{M+A(w_n)}}
> $$
>
> ​	求解目标是使得目标函数为0。一阶泰勒展开目标函数：
> $$
> f(x)=f(x_0)+f'(x_0)(x-x_0)=0
> $$
> ​	从而得到迭代公式：
> $$
> x=x_0-\frac{f(x)}{f'(x_0)}
> $$
>
> + 目标函数求导：
>
> $$
> f'(w_n)=1-\frac{A}{2[M+A(w_n)]}\sqrt{\frac{C}{M+A(w_n)}}
> $$
>
> + 初始化并迭代求解
>
> $$
> w_0=0.5,\ \ \ \  w_{n+1}=w_n-\frac{f(w_n)}{f'(w_{n})}
> $$

#### 4.2.2 六自由度耦合系统自然周期计算

​	六自由度耦合系统需要转化成六个解耦的系统，然后针对每个系统计算自然频率。对于线性耐波性模型：
$$
[M_{RB} + A(\omega)]\ddot{\xi} + [B(\omega) + B_V(\omega) + K_d]\dot{\xi} + [C + K_p]\xi = 0
$$
​	其中$\xi$是六自由度运动的跟踪误差，$K_p,K_d$是用于反馈控制的正定矩阵，$A(w),B(w)$是与频率相关的附加质量和势流阻尼，$B_V(w)$是粘性阻尼。简写为：
$$
M(\omega)\ddot{\xi} + D(\omega)\dot{\xi} + G\xi = 0
$$
​	其中，$M(w)=M(w)^T>0,D(w)=D(w)^T>0$。

​	对于使用PD控制器的振荡系统(如船舶)：
$$
\boldsymbol \xi = \boldsymbol a cos(wt)
$$
​	将上式带入(147)中，并进行**拉普拉斯变化**，得到频域模型为：
$$
[G-w^2M(w)-jwD(w)]\boldsymbol a=\boldsymbol0
$$
​	对于无阻尼系统，D=0：
$$
[G-w^2M(w)]\boldsymbol a=\boldsymbol0
$$
​	由于阻尼对水下航行器的自然频率的影响通常小于1%，通常直接使用无阻尼系统的自然频率近似代替真实振荡频率。求解式(152)即求解一个广义特征值问题：
$$
G\boldsymbol x_i=\lambda_iM(w)\boldsymbol x_i。i=1...6
$$

$$
\lambda^*_i(w)=w^2
$$

​	其中$\boldsymbol x_i$是特征向量，$\lambda_i$是特征值，解为：
$$
|G-\lambda_iM(w)|=0
$$
​	这是一个六阶多项式：
$$
\lambda^6 + a_5 \lambda^5 + a_4 \lambda^4 + a_3 \lambda^3 + a_2 \lambda^2 + a_1 \lambda + a_0 = 0
$$
​	将对应各个$w_i$的$\lambda$表示为$\lambda^*_i(w)$，根据牛顿迭代法：
$$
\omega_{i,k+1} = \omega_{i,k} - \frac{f_i(\omega_{i,k})}{f_i'(\omega_{i,k})} \quad (i=1,\ldots,6, \ k=1,\ldots,n)
$$
​	其中k表示迭代次数，i表示考虑的自由度。根据公式(152)，目标函数为：
$$
f_i(\omega_{i,k}) = \lambda_i^*(\omega_{i,k}) - \omega_{i,k}^2\\
f'_i(\omega_{i,k})=-2\omega_{i,k}
$$

> ​	解上述问题，对每个自由度，首先初始化$w_{i,0}$，然后解特征方程(155)得到$\lambda$，并计算(158)，最后使用式(157)迭代求解。
>
> ![108922085c65b90005bef635ec4b4cc](https://gitee.com/airporal/image_hub/raw/master/img/202506051413279.jpg)

## 5. 耐波性(Seakeeping)

​	耐波性是指在波浪激励下，船舶在恒定航向、恒定航速下的运动规律。耐波性研究中使用的参考系是一个与以恒定速度和航向角运动的虚拟航行器（实际航行器的平均值）固定的坐标系s。一般在s坐标系中计算波浪激励力和辐射力。耐波性理论中引入了由流体记忆效应产生的耗散力。

​	耐波性理论在s系下进行研究，它的时域解被称为Cummins equation，可以转换到b系。其中流体波浪辐射产生的力和力矩使用脉冲激励方程和状态空间模型表示。耐波性理论假设系统为线性系统，满足线性叠加理论，需要在时域中叠加粘滞阻尼的影响。 耐波性理论的运动方程在b系下的表达为：
$$
\boldsymbol{\dot\eta=J_{\Theta}(\eta)v}\\
\boldsymbol{
M_{RB} \dot{v} + C_{RB}^* v + M_A \dot{v}_r + C_A^* v_r + Dv_r + \mu + G\eta + g_o = \tau + \tau_{\text{wind}} + \tau_{\text{wave}}}
$$
​	其中，$\boldsymbol{\mu}$表示流体记忆效应导致的额外项，在设计海洋航行器控制系统时，需要估计惯性、阻尼、恢复力系数，通过第三章的结论可以计算得到刚体矩阵$\boldsymbol{M_{RB}}$和刚体旋转导致的科氏力-向心力矩阵$\boldsymbol{C^*_{RB}}$，使用第四章的结论可以得到静力产生的恢复力$g(\eta)=G\eta$和重力和浮力中心偏移导致的静态力$\boldsymbol{g_o}$，以及当存在压载系统时产生的压载力$G\eta$。本章中给出附加质量$M_A$和由于耐波性参考系{s}相对于惯性系n旋转导致的线性科氏力-向心力$\boldsymbol{C^*_A}$和 **线性势流阻尼**$D_P$。此外加入线性粘滞阻尼$D_v$来获得更加精确的模型。

![image-20250612203127983](https://gitee.com/airporal/image_hub/raw/master/img/202506122031852.png)

​	对于$M_A、C_A、D_p、\mu、\tau_{wave}$的传递函数可以通过水动力仿真软件计算。水动力系数的主要依靠势流理论计算（假设流体速度恒定、无旋、不可压缩，则可以忽略时间影响）,由于实际流体和理想流体之间存在差异，因此引入耗散力来补偿，如粘滞阻尼。

### 5.1 流体动力学概念和势流理论

​	描述流体现象与流体中的航行器运动需要知道不同位置流体的流速和压强。流体流动速度向量表示为：
$$
\boldsymbol v(\boldsymbol x,t)=[ v_1(\boldsymbol x,t), v_2(\boldsymbol x,t), v_3(\boldsymbol x,t)]^T
$$
​	假设流体不可压缩，则流体密度为常数，对于封闭表面积S下的体积为V的流体，结合高斯公式，得到净流出速度为：
$$
\iint_{S} \mathbf{v} \cdot \mathbf{n} \, ds = \iiint_{V} \text{div}(\mathbf{v}) \, dV = 0
$$
​	上式对流体中任意体积V都成立，其中div表示散度，假设$\nabla \boldsymbol v$连续，得到连续不可压缩流体方程：
$$
div(\mathbf{v})=\nabla \cdot \mathbf{v} = \frac{\partial v_1}{\partial x} + \frac{\partial v_2}{\partial y} + \frac{\partial v_3}{\partial z} = 0
$$
​	通过NS方程描述的流体的动量：
$$
\rho \left( \frac{\partial \mathbf{v}}{\partial t} + \mathbf{v} \cdot \nabla \mathbf{v} \right) = \rho \mathbf{F} - \nabla p + \mu \nabla^2 \mathbf{v}
$$
​	其中$F=[0,0,-g]^T$是由于体积力产生的加速度，仅仅考虑重力；$p=p(\boldsymbol x,t)$代表压强，$\mu$代表流体粘性系数。

> [!CAUTION]
>
> ​	要得到航行器流体动力的精确解，需要解方程（160）和方程（161），这是一个非线性偏微分方程组，无法得到解析解，目前仅能通过计算得到数值解。

​	如果忽略流体粘性，则称为理想流体。由于粘性通常只对靠近航行器的薄层产生影响，因此理想流体假设通常被考虑。则式(161)可以写成流体运动的**欧拉方程**：
$$
\rho \left( \frac{\partial \mathbf{v}}{\partial t} + (\mathbf{v} \cdot \nabla) \mathbf{v} \right) = \rho \, \mathbf{F} - \nabla p
$$
​	如果假设流体无旋（无旋必有势，由势必无旋）：
$$
\mathbf{w} =curl( \mathbf{v})=\nabla \times \mathbf{v} = \mathbf{0}
$$
​	势流理论描述无旋不可压缩无粘性的理想流体，势流理论中存在一个标量的势函数满足：
$$
\mathbf{v} = \nabla \Phi
$$
​	当势函数已知时，可以求出流体速度：
$$
v_1 = \frac{\partial \Phi}{\partial x}, \quad v_2 = \frac{\partial \Phi}{\partial y}, \quad v_3 = \frac{\partial \Phi}{\partial z}
$$
​	根据势函数，可以将连续性方程（即方程160）写成拉普拉斯方程：
$$
\nabla^2 \Phi = \frac{\partial^2 \Phi}{\partial x^2} + \frac{\partial^2 \Phi}{\partial y^2} + \frac{\partial^2 \Phi}{\partial z^2} = 0
$$
​	通过合适的边界条件，可以解上式。对欧拉方程(162)进行积分，得到伯努利方程：
$$
\frac{p}{\rho} + \frac{\partial \Phi}{\partial t} + \frac{1}{2} (\nabla \Phi)^2 + g z = C
$$

> [!NOTE]
> $$
> \frac{\partial \mathbf{v}}{\partial t} + (\mathbf{v} \cdot \nabla) \mathbf{v} = \mathbf{F} - \nabla \frac{p}{\rho}
> \\--\\
> (\mathbf{v} \cdot \nabla) \mathbf{v}=\nabla(\frac{\mathbf{v}^2}{2})-2 \mathbf{v}\times \mathbf w ,\ \ F=[0,0,-g]^T=-\nabla(gz)
> \\ --\\
> \nabla\frac{\partial \Phi}{\partial t} +\nabla(\frac{\mathbf{v}^2}{2})-2 \mathbf{v}\times \mathbf w = -\nabla(gz)- \nabla \frac{p}{\rho}
> \\ -- \\
> \nabla\frac{\partial \Phi}{\partial t} +\nabla(\frac{\mathbf{v}^2}{2}) +\nabla(gz)+\nabla \frac{p}{\rho}=0
> \\--\\
> \frac{p}{\rho} + \frac{\partial \Phi}{\partial t} + \frac{1}{2} (\nabla \Phi)^2 + g z = C
> $$
> ​	无旋、不可压缩理想流体(无粘度)、质量力仅仅有重力。

​	取式167中常数$C=\frac{p_0}{\rho}$则：
$$
p - p_0 = -\rho g z - \rho \frac{\partial \Phi}{\partial t} - \frac{1}{2} \rho (\nabla \Phi)^2
$$
🚤根据势流理论求水动力就是求p，关键是根据势流假设求势函数，而势函数的求解需要解拉普拉斯方程，这需要根据实际问题给出边界条件。

1️⃣ 薄片理论（2维势流理论）

​	细长体的运动过程中流体效应可以假设简化为2维，并假设流体仅仅在长的方向上对细长体产生影响，则将细长体沿着该方向划分为多个薄片，分别计算每个薄片的附加质量、阻尼和受力，最后对所有薄片积分求出整体的受力。

2️⃣ 板块法（3维势流理论）

3️⃣ 经验法

### 5.2 耐波性与操纵性运动学

​	基于耐波性理论的航行器运动学方程通过平衡状态的运动和由于波浪一阶激励产生的扰动叠加组成，平衡状态指的是速度和艏向角保持不变的状态，而扰动为零均值的振动，在Seakeeping reference frame坐标系下研究。

![eea114c72e4abd8bc893061c119f652](https://gitee.com/airporal/image_hub/raw/master/img/202506161213338.jpg)

​	s系与航行器的平衡状态固定。在没有波浪激励时，$o_s$和b系的原点$o_b$相同，当存在波浪激励时，s系的原点也相对于某个平衡位置振荡。

​	研究时，假设s系是固定的或者缓慢变化的，此时s系下的运动方程线性。航行器的平衡位置通过恒定的艏向角和速度定义：
$$
\mathbf{v}_{s/n}^n = \begin{bmatrix} U \cos(\bar{\psi}),\ U \sin(\bar{\psi}) ,\ 0 \end{bmatrix}^T
\\
\boldsymbol{\omega}_{s/n}^n = \begin{bmatrix} 0 ,\  0 ,\  0 \end{bmatrix}^T\\

\Theta_{ns} = \begin{bmatrix} 0 ,\  0 ,\  \bar{\psi} \end{bmatrix}^T
$$
​	其中$U=||\boldsymbol v^n_{s/n}||$是航行器前进的平均速度，$\bar{\psi}$是平衡艏向角。则根据欧拉角的坐标转化矩阵得到s系相对于n系的速度在s系下的表示为：
$$
\mathbf{v}_{s/n}^s = \mathbb{R}_n^s(\boldsymbol{\Theta}_{ns}) \mathbf{v}_{s/n}^n = \begin{bmatrix} U ,\  0 ,\  0 \end{bmatrix}^T
$$
​	平均艏向角使用陀螺仪测量一定时间内的艏向角平均值即可得到。
$$
\mathbf\xi =\delta \mathbf{\mathbf\eta} := 
\begin{bmatrix}
\mathbf{r}^s_{b/s} \\
\boldsymbol{\Theta}_{sb}
\end{bmatrix}\\

\delta \mathbf{v} := 
\begin{bmatrix}
\mathbf{v}^b_{b/s} \\
\boldsymbol{\omega}^b_{b/s}
\end{bmatrix}
$$
​	其中$\xi$是六自由度的扰动产生导致的位置误差。其导数为：
$$
\delta \dot{\boldsymbol{\eta}} = \mathbf{J}_{\Theta}(\delta \boldsymbol{\eta}) \delta \boldsymbol{\nu}
$$
​	其中$\mathbf{J}_{\Theta}(\delta \boldsymbol{\eta})$是b系和s系的运动转换矩阵，它由速度转换的旋转矩阵和角速度转换矩阵构成，结构和2.2中b系和n系的速度与角速度转换一致。
$$
\mathbf{J}_{\Theta}(\delta \boldsymbol{\eta}) = 
\begin{bmatrix}
\mathbf{R}_b^s(\boldsymbol{\Theta}_{sb}) & \mathbf{0}_{3 \times 3} \\
\mathbf{0}_{3 \times 3} & \mathbf{T}_{\Theta}(\boldsymbol{\Theta}_{sb})
\end{bmatrix}
$$
​	由于n、b、s坐标系原点满足以下关系：
$$
\vec{r}_{b/n} = \vec{r}_{s/n} + \vec{r}_{b/s}
$$
​	在n系下表示为：
$$
\mathbf{r}_{b/n}^n = \mathbf{r}_{s/n}^n + \mathbf{R}_s^n(\boldsymbol{\Theta}_{ns}) \mathbf{r}_{b/s}^s
$$
​	对时间求微分：
$$
\dot{\mathbf{r}}_{b/n}^n = \dot{\mathbf{r}}_{s/n}^n + \mathbf{R}_s^n(\boldsymbol{\Theta}_{ns}) \dot{\mathbf{r}}_{b/s}^s
$$
​	旋转矩阵只有沿着艏向的旋转，即yaw的运动，旋转矩阵为：
$$
\mathbf{R}_s^n(\boldsymbol{\Theta}_{ns}) = \mathbf{R}_{z,\bar{\psi}} = 
\begin{bmatrix}
\cos(\bar{\psi}) & -\sin(\bar{\psi}) & 0 \\
\sin(\bar{\psi}) & \cos(\bar{\psi}) & 0 \\
0 & 0 & 1
\end{bmatrix}, \quad \dot{\mathbf{R}}_s^n(\boldsymbol{\Theta}_{ns}) = \mathbf{0}
$$
​	旋转矩阵的时间微分为0，因为旋转矩阵与艏向角的均值有关，由于s系相对于n系静止，默认认为均值不改变。将旋转变化分解，以转化到b系下表示：
$$
\dot{\mathbf{r}}_{b/n}^n = \dot{\mathbf{r}}_{s/n}^n + \mathbf{R}_b^n(\boldsymbol{\Theta}_{nb}) \mathbf{R}_s^b(\boldsymbol{\Theta}_{bs}) \dot{\mathbf{r}}_{b/s}^s 

= \dot{\mathbf{r}}_{s/n}^n + \mathbf{R}_b^n(\boldsymbol{\Theta}_{nb}) \mathbf{v}_{b/s}^b
$$
​	在等号左边同时乘上一个$ \mathbf{R}_n^b(\boldsymbol{\Theta}_{bn})$得到：
$$
\mathbf{v}_{b/n}^b = \mathbf{R}_n^b(\boldsymbol{\Theta}_{bn}) \mathbf{v}_{s/n}^n + \mathbf{v}_{b/s}^b
$$
​	以上仅仅考虑三维速度，为了方便讨论，将速度与角速度组合讨论：
$$
\mathbf{v} = 
\begin{bmatrix}
\mathbf{v}_1 \\
\mathbf{v}_2
\end{bmatrix} =
\begin{bmatrix}
[u, v, w]^T \\
[p, q, r]^T
\end{bmatrix}
\ \ \ \\ 
\delta \mathbf{v} = 
\begin{bmatrix}
\delta \mathbf{v}_1 \\
\delta \mathbf{v}_2
\end{bmatrix} =
\begin{bmatrix}
[\delta u, \delta v, \delta w]^T \\
[\delta p, \delta q, \delta r]^T
\end{bmatrix}
$$
​	根据式(180)：
$$
\boldsymbol{v}_1 = \overline{\boldsymbol{v}}_1 + \delta \boldsymbol{v}_1
$$
​	其中：
$$
\overline{\boldsymbol{v}}_1 := \mathbf{R}_n^b(\boldsymbol{\Theta}_{bn}) 
\begin{bmatrix}
U \cos(\overline\psi) \\
U \sin(\overline\psi) \\
0
\end{bmatrix} 
= \mathbf{R}_s^b(\boldsymbol{\Theta}_{bs})
\begin{bmatrix}
U \\
0 \\
0
\end{bmatrix}
$$
​	对于角速度项，由于s系和n系都是惯性系$ \boldsymbol{\omega}_{s/n}=0$：
$$
\boldsymbol{\omega}_{b/n} = \boldsymbol{\omega}_{s/n} + \boldsymbol{\omega}_{b/s} = \boldsymbol{\omega}_{b/s}
$$
​	即：
$$
\boldsymbol{\omega}_{b/n}^b = \boldsymbol{\omega}_{b/s}^b\\
\boldsymbol{v}_2 = \delta \boldsymbol{v}_2
$$

> $v_{1,2}$是b相对于n系在b系下的表达，$\delta \boldsymbol{v}_{1,2}$是b系相对于s系在b系下的表达。

​	b系和s系之间的速度和角速度变化矩阵与2.2节中类似：
$$
\mathbf{R}_b^s(\boldsymbol{\Theta}_{sb}) = 
\begin{bmatrix}
c_{\delta\psi}c_{\delta\theta} & -s_{\delta\psi}c_{\delta\phi}+c_{\delta\psi}s_{\delta\theta}s_{\delta\phi} & s_{\delta\psi}s_{\delta\phi}+c_{\delta\psi}c_{\delta\phi}s_{\delta\theta} \\
s_{\delta\psi}c_{\delta\theta} & c_{\delta\psi}c_{\delta\phi}+s_{\delta\phi}s_{\delta\theta}s_{\delta\psi} & -c_{\delta\psi}s_{\delta\phi}+s_{\delta\theta}s_{\delta\psi}c_{\delta\phi} \\
-s_{\delta\theta} & c_{\delta\theta}s_{\delta\phi} & c_{\delta\theta}c_{\delta\phi}
\end{bmatrix}
\\
\mathbf{T}_{\Theta}(\boldsymbol{\Theta}_{sb}) = 
\begin{bmatrix}
1 & s_{\delta\phi}t_{\delta\theta} & c_{\delta\phi}t_{\delta\theta} \\
0 & c_{\delta\phi} & -s_{\delta\phi} \\
0 & s_{\delta\phi}/c_{\delta\theta} & c_{\delta\phi}/c_{\delta\theta}
\end{bmatrix}, \quad c_{\delta\theta} \neq 0
$$
​	带入到公式(183)中，得到平均的速度(假设运动角度很小)：
$$
\overline{\boldsymbol{v}}_1 = \mathbf{R}_b^s(\boldsymbol{\Theta}_{sb})^T 
\begin{bmatrix}
U \\
0 \\
0
\end{bmatrix}
= U 
\begin{bmatrix}
c_{\delta\psi}c_{\delta\theta} \\
-s_{\delta\psi}c_{\delta\phi} + c_{\delta\psi}s_{\delta\theta}s_{\delta\phi} \\
s_{\delta\psi}s_{\delta\phi} + c_{\delta\psi}c_{\delta\phi}s_{\delta\theta}
\end{bmatrix}

\approx U 
\begin{bmatrix}
1 \\
-\delta\psi \\
\delta\theta
\end{bmatrix}
$$
​	则：
$$
\overline{\boldsymbol{v} }\approx U \begin{bmatrix} 1 ,\  -\delta\psi ,\  \delta\theta ,\  0 ,\  0 ,\  0 \end{bmatrix}^T
$$
​	根据公式(186)可以写成：
$$
\mathbf{v} \approx U(\mathbf{e}_1 - \mathbf{L}\delta\boldsymbol{\eta}) + \delta\mathbf{v}
\\
\mathbf{e}_1 := 
\begin{bmatrix}
1 \\
0 \\
0 \\
0 \\
0 \\
0
\end{bmatrix}, \quad
\mathbf{L} := 
\begin{bmatrix}
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 1 \\
0 & 0 & 0 & 0 & -1 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0
\end{bmatrix}
$$
​	微分后得到加速度：
$$
\dot{\boldsymbol{v}} = \dot{\tilde{\boldsymbol{v}}} + \delta \dot{\boldsymbol{v}}
$$
​	由公式(187)得到：
$$
\dot{\overline{\boldsymbol{v} }}=[\dot{\mathbf{v}}_1,0]^T = U \begin{bmatrix} 1 \\ -\delta r \\ \delta q \\0\\0\\0\end{bmatrix} = -U (\mathbf{L} \delta \mathbf{v}-e_1)
$$
​	加速度<font color=red>（加速度和书中89页有差异）</font>：
$$
\dot{\mathbf{v}} = -U (\mathbf{L} \delta \mathbf{v}-e_1) + \delta \dot{\mathbf{v}}
$$
​	根据上式和式(189)得s系下的坐标$\delta v、\delta \dot v$转换到b系下的$v、\eta$:
$$
\delta \mathbf{v} \approx \mathbf{v} + U(\mathbf{L}\delta \boldsymbol{\eta} - \mathbf{e}_1)
\\
\delta \mathbf{\dot v} \approx \mathbf{\dot v} + U\mathbf{L}\mathbf{v}-Ue_1
$$
​	对于欧拉角：
$$
\boldsymbol{\Theta}_{nb} = \boldsymbol{\Theta}_{ns} + \boldsymbol{\Theta}_{sb}
$$
​	即：
$$
\begin{bmatrix} \phi \\ \theta \\ \psi \end{bmatrix} = \begin{bmatrix} 0 \\ 0 \\ \bar{\psi} \end{bmatrix} + \begin{bmatrix} \delta \phi \\ \delta \theta \\ \delta \psi \end{bmatrix}
$$


### 5.3 经典频域模型

​	经典频域模型可以用于设计获取与水流频率相关的附加质量和阻尼实验或代码。耐波系s下的运动方程满足惯性要求，因而根据刚体动力学，扰动满足：
$$
\delta \dot{\boldsymbol{\eta}} = \mathbf{J}_{\Theta}(\delta \boldsymbol{\eta}) \delta \boldsymbol{\nu}
\\
\mathbf{M}_{RB} \delta \ddot{\boldsymbol{\eta}} + \mathbf{C}_{RB}(\delta \boldsymbol{\nu}) \delta \dot{\boldsymbol{\eta}} = \delta \boldsymbol{\tau}_{RB}
$$
​	根据线性假设忽略二阶项：
$$
\xi=\delta\eta,\dot\xi=\delta v\\
\mathbf{M}_{RB} \ddot{\boldsymbol{\xi}} = \delta \mathbf{\tau}_{RB} 

= \mathbf{\tau}_{hyd} + \mathbf{\tau}_{hs} + \mathbf{\tau}_{exc}
$$
​	动水动力项：
$$
\boldsymbol{\tau}_{hyd} = -\bar{\mathbf{A}}\dot{\boldsymbol{\xi}} - \int_0^t \bar{\mathbf{K}}(t-\tau)\dot{\boldsymbol{\xi}}(\tau)d\tau
$$
​	其中，$\bar{\mathbf{A}}=A(\infin)$是频率趋于无穷时的附加质量矩阵，B是势流阻尼，K是延迟函数：
$$
\bar{\mathbf{K}}(t) = \frac{2}{\pi} \int_{0}^{\infty} \mathbf{B}(\omega) \cos(\omega t) d\omega
$$
​	水静力假设为线性恢复力$\tau_{hs}=-C\boldsymbol\xi$，则代入到公式(196)中，得到时域下的微分-积分模型：
$$
(\mathbf{M}_{RB} + \mathbf{A}(\infty))\ddot{\boldsymbol{\xi}} + \int_0^t \bar{\mathbf{K}}(t - \tau)\dot{\boldsymbol{\xi}}(\tau)d\tau + \mathbf{C}\boldsymbol{\xi} = \boldsymbol{\tau}_{exc}
$$
​	剩下的最后一项是其他外部激励。

#### 5.3.1 强迫振荡

​	现在假设一个浮体受以下流体力作用：
$$
\mathbf{M}_{RB} \ddot{\boldsymbol{\xi}} = \boldsymbol{\tau}_{hyd} + \boldsymbol{\tau}_{hs} + \boldsymbol f \cos(\omega t)
$$
​	其中$\boldsymbol \tau_{hyd}$和$\tau_{hs}$分别是周围流体导致浮体的水动力和水静力。$\boldsymbol f=[f_1,f_2,f_3,f_4,f_5,f_6]^T$是外部激励的振幅。外部激励的幅值和频率可以通过约束比例实验设置，二阶系统(201)可以被拟合为一个线性模型：
$$
[\mathbf{M}_{RB} + \mathbf{A}(\omega)]\ddot{\boldsymbol{\xi}} + \mathbf{B}(\omega)\dot{\boldsymbol{\xi}} + \mathbf{C}\boldsymbol{\xi} = \mathbf{f} \cos(\omega t)
$$
​	对于每个实验频率$w$，水动力、水静力被认为是一个和频率相关的质量—阻尼—弹簧系统。
$$
\boldsymbol{\tau}_{hyd} + \boldsymbol{\tau}_{hs} = -\mathbf{A}(\omega)\ddot{\boldsymbol{\xi}} - \mathbf{B}(\omega)\dot{\boldsymbol{\xi}} - \mathbf{C}\boldsymbol{\xi}
$$
​	零阶项是恢复力项(静力->弹簧);一阶和二阶项是辐射力(radiation force，水动力->质量+阻尼)。波浪产生了辐射力被分为了水动力惯性力和阻尼力，其中$A(w)$表示附加质量，$B(w)$表示potential 阻尼，A和B是势流理论的两个potential 系数矩阵。进行多次频率不同的实验($w_i>0,(i=1,...N)$)，可以计算出不同频率的$A(w_i)和B(w_i)$。

​	控制波浪频率进行受迫振动实验，得到以下系数变化趋势(A、B、C类似)：

![cca440a0dc3475fe6e39c3d953a970e](https://gitee.com/airporal/image_hub/raw/master/img/202506161825637.jpg)

​	系数A、B、C都随着受迫振动波浪的频率变化而变化。

+ 附加质量（Added Mass）

  附加质量并不简单的指航行器拖拽的有限体积的水的质量。航行器在水下运动时，从一个位置运动到另一个位置，必须首先排开该位置的所有流体，流体力学的附加质量可以看作是系统中增加的虚质量。

#### 5.3.2 频域耐波性模型

​	公式(200)可以转换到频域下：
$$
\xi_i(t) = \bar{\xi}_i \cos(\omega t + \epsilon_i) \quad \Rightarrow \quad \xi_i(j\omega) = \bar{\xi}_i e^{j\epsilon_i}
\\
\tau_{\text{exc},i}(t) = \bar{\tau}_i \cos(\omega t + \epsilon_i) \quad \Rightarrow \quad \tau_{\text{exc},i}(j\omega) = \bar{\tau}_{\text{exc},i} e^{j\epsilon_i}\\
带入公式(200)得到：\\
\left(-\omega^2 [\mathbf{M}_{RB} + \mathbf{A}(\omega)] - j\omega \mathbf{B}(\omega) + \mathbf{C}\right) \boldsymbol{\xi}(j\omega) = \boldsymbol{\tau}_{exc}(j\omega)
$$

> [!WARNING]
>
> ​	耐波性的频域模型是公式(204)，公式(202)并非耐波性的时域模型，而是公式(204)的另一种写法。耐波性的时域模型是公式(200)。

​	potential 系数矩阵$A(w)$和$B(w)$通常使用Seakeeping program计算，但是由于没有考虑粘性阻尼而不精确。考虑包括表面摩擦、直航阻力、粘性横滚阻尼，整体阻尼系数矩阵为：
$$
\boldsymbol B_{total}(w)=\boldsymbol B(w)+\boldsymbol B_{V}(w)
$$
​	航行器受到的压强可以分为两部分，一部分是和排开水的体积成正比的静态压强，提供航行器的浮力，水静力($C\xi$)和重力一起构成恢复力，使得航行器有朝着正向平衡位置恢复运动的趋势。波浪激励力$\tau_{wave}$是由于波浪引起的压力变化而产生的，包含与波浪角线性变化的部分以及非线性部分。线性力以零为均值振荡，这些力被称为一阶波浪力和衍生力。这些力以和在船上看到的波浪高度变化频率相同的频率分散。非线性力反应的是非振荡的平均波浪漂流力和能量变化频率要么高于要么低于一阶波浪力的范围的振荡力。低于一阶波浪力的称为二阶漫波漂移力，它和平均波浪漂移力、一阶波浪力一起构成了航行器运动控制的主要扰动。高频力一般与航行器运动控制无关，但是可能会导致航行器结构的振荡。

​	包含波浪力或风力的频率模型为：
$$
\left(-\omega^2 [\mathbf{M}_{RB} + \mathbf{A}(\omega)] - j\omega \mathbf{B_{total}}(\omega) + \mathbf{C}\right) \boldsymbol{\xi}(j\omega) = \boldsymbol{\tau}_{wave}(j\omega) + \boldsymbol{\tau}_{wind}(j\omega) + \boldsymbol{\delta\tau}(j\omega)
$$

+ 与频率相关的线性粘性阻尼

​	当使用基于耐波性理论的代码计算由于一阶或二阶波浪力导致的运动时，需要加入外部粘性阻尼矩阵来获得更加精确的响应幅度算子(Response Amplitude Operators)。

​	Bailey 使用surge、sway和yaw的趋势来描述粘性阻尼力，对于线性理论来说，可以使用指数函数来很好的描述粘性阻尼力，例如：
$$
\mathbf{B}_V(\omega) = 
\begin{bmatrix}
\beta_1 e^{-\alpha \omega}+N_{ITTC}(A_1) & 0 & 0 & 0 & 0 & 0 \\
0 & \beta_2 e^{-\alpha \omega} & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & \beta_{\text{IKEDA}}(\omega) & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0 & \beta_6 e^{-\alpha \omega}
\end{bmatrix}
$$
​	其中，$\alpha>0$是指数率，$\beta_i>0,(i=1,2,6)$表示水平运动的线性表面摩擦粘性阻尼系数。$N_{ITTC}(A_1)$是与艏向运动振幅相关的线性等效直航阻力。$\beta_{\text{IKEDA}}(\omega)$是基于Ikeda理论的与roll频率相关的阻尼。此外，还有一些其它的粘性阻尼模型可以替代此方法。

+ 等价线性化理论和描述函数

​	直航阻力$N_{ITTC}(A_1)$可以以使用线性二次阻尼代替。等效线性化傅里叶级数线性近似一个周期内的非线性项。这和控制工程中使用正弦激励的描述函数相似，正弦输入为：
$$
u = Asin(wt)
$$
​	对于以下形式的非线性映射关系：
$$
y = c_1 x + c_2 x |x| + c_3 x^3
$$
​	可以使用如下的线性参数替代：
$$
N(A) = c_1 + \frac{8A}{3\pi}c_2 + \frac{3A^2}{4}c_3
$$
​	得到和振幅相关的输出映射为：
$$
y=N(A)u
$$
​	当输入是谐波函数时，可以使用上式来拟合非线性映射(209)。假设波浪存在规律的前提下，可以用这个方法来拟合非线性的耗散力。例如：使用ITTC表达的surge方向的二次阻尼：
$$
X = -X_{|u|u}|u|u 
\approx N_{\text{ITTC}}(A_1)u
$$
​	surge 速度为谐波函数$u=A_1cos(wt)$，因此得到：
$$
N_{\text{ITTC}}(A_1) = -\frac{8A_1}{3\pi} X_{|u|u}
$$
​	在sway和yaw方向运动的粘性阻尼也可以使用类似的方法建模。当受到横向的洋流时，sway和yaw的 振幅$A_2$和$A_6$和产生的流体力关系为：
$$
Y = N_{Y,\text{crossflow}}(A_2)v,\\

N = N_{N,\text{crossflow}}(A_6)r,\\

N_{Y,\text{crossflow}}(A_2) = -\frac{8A_2}{3\pi}Y_{|v|v}\\

N_{N,\text{crossflow}}(A_6) = -\frac{8A_6}{3\pi}N_{|r|r}\\
$$
​	当航行器高速运动时，振幅$A_{2,6}$远小于振幅$A_1$，因此通常可以忽略sway和yaw的振荡。

### 5.4 包含流体记忆效应的时域模型

​	时域模型有利于仿真和控制系统设计，便于添加非线性项来表示高速情况下的耦合效应。流体记忆效应和波浪力不包括在耐波性理论中，因而可以看作是耐波性和操作性理论的混合。

#### 5.4.1 耐波性坐标系下的Cummins 方程

​	Cummins 方程在线性假设下考虑了航行器推进器的作用力。这是一个边界值问题，将势分为了两个部分讨论，一部分是推进器工作期间，另一个部分是推进器停止后。Cummins建立了势函数并沿着航行器的湿表面积分，最终得到一个向量形式的积分-微分方程（即方程198）。加入粘性阻尼、恢复力、波浪力和风力后，时域耐波性模型为：
$$
(\mathbf{M}_{RB} + \mathbf{\bar A})\ddot{\boldsymbol{\xi}} + \int_0^t \mathbf{\bar K}(t - \tau)\dot{\boldsymbol{\xi}}(\tau)d\tau + \mathbf{\bar C}\boldsymbol{\xi} = \boldsymbol{\tau}_{wind} + \boldsymbol{\tau}_{wave}+\delta \tau
$$
​	其中，$\delta \tau$是干扰控制输入，$\bar A ,\bar C$是需要设置的常矩阵，$\bar K(t)$是延时函数的矩阵：
$$
\bar{K}(t) = \frac{2}{\pi} \int_{0}^{\infty} B_{\text{total}}(\omega) \cos(\omega t) \, d\omega
$$
​	方程(215)是航行器在s系下时域的运动方程，对于任何满足线性假设的激励都适用，表示使得平衡状态振荡的力。$\bar A$是一个常量，与运动频率和前向速度都无关。

​	航行器运动时会在自由表面产生波浪，这些波浪原则上会对后续的运动产生持续的影响，这被称为流体的记忆效应，它们通过对公式(215)进行卷积项（$\int_0^t \mathbf{\bar K}(t - \tau)\dot{\boldsymbol{\xi}}(\tau)d\tau$）积分得到。卷积项和船体几何形状、前向速度都有关。

+ The Ogilvie Transformations

​	Ogilvie假设航行器以谐波形式振荡：
$$
\boldsymbol{\xi} = \cos(\omega t) \mathbf{i}, \quad \mathbf{i} = [1, 1, 1, 1, 1, 1]^T
$$
​	带入到康明斯方程(215)中，得到：
$$
-\omega^2 [\mathbf{M}_{RB} + \mathbf{\bar A}]\cos(\omega t) + \int_{-\infin}^t \mathbf{\bar K}(\tau)\sin(\omega t - \omega \tau)d\tau + \mathbf{\bar C}\cos(\omega t)= \boldsymbol{\tau}_{wind} + \boldsymbol{\tau}_{wave} + \mathbf{\delta \tau}
$$
​	为方便积分，使用$t-\tau $替代$\tau$:
$$
-\omega^2 \left\{ [\mathbf{M}_{RB} + \tilde{\mathbf{A}}] - \frac{1}{\omega} \int_0^\infty \tilde{\mathbf{K}}(\tau) \sin(\omega \tau) d\tau \right\} \cos(\omega t)

-\omega \left\{ \int_0^\infty \tilde{\mathbf{K}}(\tau) \cos(\omega \tau) d\tau \right\} \sin(\omega t) + \tilde{\mathbf{C}} \cos(\omega t) = \boldsymbol{\tau}_{\text{wind}} + \boldsymbol{\tau}_{\text{wave}} + \delta \boldsymbol{\tau}
$$
​	通过拉普拉斯变化，得到频域下的表达：
$$
-\omega^2 [\mathbf{M}_{RB} + \mathbf{A}(\omega)]\cos(\omega t) - \omega[ \mathbf{B}_{total}(\omega) \sin(\omega \tau) d\tau ]\sin(\omega t) + \mathbf{C}\cos(\omega t) = \boldsymbol{\tau}_{wind} + \boldsymbol{\tau}_{wave} + \delta \tau
$$
​	要满足时域和频域方程，对于所有的$w$需要满足：
$$
\mathbf{A}(\omega) = \bar{\mathbf{A}} - \frac{1}{\omega} \int_{0}^{\infty} \bar{\mathbf{K}}(\tau) \sin(\omega\tau) d\tau
$$
​	可以选择$w=\infin$则$\bar A=A(\infin)$。根据傅里叶逆变换：
$$
\mathbf{B}_{\text{total}}(\omega) = \int_{0}^{\infty} \bar{\mathbf{K}}(\tau) \cos(\omega\tau) d\tau\\

\bar{\mathbf{K}}(t) = \frac{2}{\pi} \int_{0}^{\infty} \mathbf{B}_{\text{total}}(\omega) \cos(\omega t) \, d\omega
$$
​	直接使用公式(222)中的延时函数$\bar K$会导致振荡。在数值的角度，通常使用$K$替代：
$$
\mathbf{K}(t) = \frac{2}{\pi} \int_{0}^{\infty} [\mathbf{B}_{\text{total}}(\omega) - \mathbf{B}_{\text{total}}(\infty)] \cos(\omega t) \, d\omega
$$
![cc8c9fbd38e1b5cd22b0842f4f21167](https://gitee.com/airporal/image_hub/raw/master/img/202506172024162.jpg)

​	对K进行积分，随着$w$的增大，由于$\mathbf{B}_{\text{total}}(\omega) - \mathbf{B}_{\text{total}}(\infty)$趋于0，曲线收敛到0。这两种延时函数存在以下关系：
$$
\tilde{\mathbf{K}}(t) = \frac{2}{\pi} \int_{0}^{\infty} [\mathbf{B}_{\text{total}}(\omega) - \mathbf{B}_{\text{total}}(\infty) + \mathbf{B}_{\text{total}}(\infty)] \cos(\omega \tau) \, d\omega

= \mathbf{K}(t) + \frac{2}{\pi} \int_{0}^{\infty} \mathbf{B}_{\text{total}}(\infty) \cos(\omega \tau) \, d\omega
$$
​	满足：
$$
\int_{-\infty}^{t} \bar{\mathbf{K}}(t - \tau) \dot{\boldsymbol{\xi}}(\tau) d\tau = \int_{-\infty}^{t} \mathbf{K}(t - \tau) \dot{\boldsymbol{\xi}}(\tau) d\tau + \mathbf{B}_{\text{total}}(\infty) \dot{\boldsymbol{\xi}}

= \int_0^t \mathbf{K}(t - \tau) \dot{\boldsymbol{\xi}}(\tau) d\tau + \mathbf{B}_{\text{total}}(\infty) \dot{\boldsymbol{\xi}}
$$

> [!IMPORTANT]
>
> s系下的时域耐波性方程：
> $$
> \left[ \mathbf{M}_{RB} + \mathbf{A}(\infin) \right] \ddot{\boldsymbol{\xi}} + \mathbf{B}_{total}(\infin) \dot{\boldsymbol{\xi}} + \int_0^t \mathbf{K}(t - \tau) \dot{\boldsymbol{\xi}}(\tau) d\tau + \mathbf{C} \boldsymbol{\xi} = \boldsymbol{\tau}_{wind} + \boldsymbol{\tau}_{wave} + \delta \boldsymbol{\tau}
> $$
> 

#### 5.4.2 Body系下线性时域耐波性理论方程

​	b系下线性时域耐波性方程有两种表达形式，一种是零速度下的势流系数，另外一种是使用与速度相关的矩阵。<font color=red>**运动控制系统通常建立在b系下**。</font>因此需要将康明斯方程在s系下的表达(公式226)转换到b系下。在s系下讨论时，由于是惯性系，不存在科氏力和向心力，在b系下需要额外考虑。

![47ead088ff29ee73ebc042c90ffe5a4](https://gitee.com/airporal/image_hub/raw/master/img/202506172059070.jpg)

​	使用公式(193,197)将表示b在s系下的坐标的$\eta$（偏移量）转化为b系下的$v，\eta$：
$$
[\mathbf{M}_{RB} + \mathbf{A}(\infty)][\dot{\boldsymbol{v}} + U\mathbf{L}\boldsymbol{v}] + \mathbf{B}_{\text{total}}(\infty)[\boldsymbol{v} + U(\mathbf{L}\delta \boldsymbol{\eta} - \mathbf{e}_1)]

+ \int_0^t \mathbf{K}(t - \tau)\delta \boldsymbol{v}(\tau)d\tau + \mathbf{C}\delta \boldsymbol{\eta} = \boldsymbol{\tau}_{\text{wind}} + \boldsymbol{\tau}_{\text{wave}} + (\boldsymbol{\tau} - \bar{\boldsymbol{\tau}})
$$

​	当航行器静止且不受到风力和波浪力时，上式中的稳态控制力$\bar \tau$可以求得为：
$$
\bar{\boldsymbol{\tau}} = \mathbf{B}_{\text{total}}(\infty) U \mathbf{e}_1
$$
​	代入(227)后，得到：
$$
[\mathbf{M}_{RB} + \mathbf{A}(\infty)] [\dot{\mathbf{v}} + U\mathbf{L}\mathbf{v}] + \mathbf{B}_{\text{total}}(\infty) [\mathbf{v} + U\mathbf{L}\delta\boldsymbol{\eta}] 

+ \int_0^t \mathbf{K}(t - \tau) \delta\mathbf{v}(\tau) d\tau + \mathbf{C} \delta\boldsymbol{\eta} = \boldsymbol{\tau}_{\text{wind}} + \boldsymbol{\tau}_{\text{wave}} + \boldsymbol{\tau}
$$
​	上式中，由于刚体质量和水动力附加质量导致的线性科氏-向心力项是$M_{RB}ULv、A(\infin)ULv$。在计算阻尼和延迟函数时，可以忽略$\delta \eta$对前向速度的影响：
$$
\delta \mathbf{v} \approx \mathbf{v} + U(\mathbf{L}\delta \boldsymbol{\eta} - \mathbf{e}_1)\approx \mathbf{v}-Ue_1
$$

+ 使用零速度下的势流系数表示线性运动方程

​	b系和n系的运动方程：
$$
\dot{\boldsymbol{\eta}} = \mathbf{J}_{\Theta}(\boldsymbol{\eta}) \boldsymbol{v}
$$
​	使用航行器相对于洋流的速度$v_r$代替$v$，并使用以下符号替代：
$$
\mathbf{M}_A = \mathbf{A}(\infty)\\

\mathbf{C}_A^* = U\mathbf{A}(\infty)\mathbf{L}\\

\mathbf{C}_{RB}^* = U\mathbf{M}_{RB}\mathbf{L}\\

\mathbf{D} = \mathbf{B}_{\text{total}}(\infty)\\

\mathbf{G} = \mathbf{C}\\
\mathbf{M}=\mathbf{M}_A+\mathbf{M}_{RB}\\
\mathbf{G}\eta= \mathbf{C}\delta\eta
$$
​	最终得到
$$
\mathbf{M}\dot{\boldsymbol{v}} + \mathbf{C}^*_{RB}\boldsymbol{v} + \mathbf{C}^*_{A}\boldsymbol{v_r}+\mathbf{D}\boldsymbol{v_r} + \int_0^t \mathbf{K}(t-\tau)\boldsymbol[{v}(\tau)-Ue_1]d\tau + \mathbf{G}\boldsymbol{\eta} = \boldsymbol{\tau}_{wind} + \boldsymbol{\tau}_{wave} + \boldsymbol{\tau}
$$

+ 使用速度依赖的势流系数表示线性运动方程

​	势流系数可以表示为速度和频率的函数：
$$
\mathbf{A}_U(\omega, U) = \mathbf{A}(\omega) + \boldsymbol{\alpha}(\omega, U)\\

\mathbf{B}_U(\omega, U) = \mathbf{B}(\omega) + \boldsymbol{\beta}(\omega, U)
$$
​	其中$\boldsymbol{\alpha}(\omega, U)、 \boldsymbol{\beta}(\omega, U)$是和速度相关的项，对于上面的表示方法，$ \boldsymbol{\beta}(\omega, U)$可以包括附加质量产生的向心力-科氏力$C^*_A$和一些其它的作用力，常用的表达形式为：
$$
\boldsymbol{\beta}(\omega, U) = \underbrace{U\mathbf{A}(\infty)\mathbf{L}}_{\mathbf{C}_A^*} + \mathbf{B}_{\text{ITTC}}(\omega, U) + \mathbf{B}_{\text{IKEDA}}(\omega, U) + \mathbf{B}_{\text{transom}}(\omega, U)
$$
​	使用式(234)表示公式(227)，得到：
$$
\mathbf{M_U}\dot{\boldsymbol{v}}  + \mathbf{C}^*_{RB}\boldsymbol{v}+\mathbf{D_U}\boldsymbol{v_r} + \int_0^t \mathbf{K_U}(t-\tau,U)\boldsymbol[{v}(\tau)-Ue_1]d\tau + \mathbf{G}\boldsymbol{\eta} = \boldsymbol{\tau}_{wind} + \boldsymbol{\tau}_{wave} + \boldsymbol{\tau}
$$
​	替代符号定义为：
$$
\begin{aligned}
\mathbf{M}_U &= \mathbf{M}_{RB} + \mathbf{A}_U(\infty, U) \\
\mathbf{C}^*_{RB} &= U \mathbf{M}_{RB} L \\
\mathbf{D}_U &= \mathbf{B}_{\text{total}, U}(\infty, U) \\
\mathbf{G} &= \mathbf{C}\\
\mathbf{K}_U(t, U) &= \frac{2}{\pi}\int^\infin_0 \left[ \mathbf{B}_{total,U}(w, U) - \mathbf{B}_{total,U}(\infty, U) \right] \cos(wt) \, dw

\end{aligned}
$$
​	公式(238)是在速度为常量的情况下推导的，但是当速度缓慢变化时，也可以用于时变的分析中。
$$
\begin{aligned}
\boldsymbol{\beta}(\omega, U) &:= \mathbf{C}_A^* \\
&= U \mathbf{A}(\infty) L
\end{aligned}
$$
​	零速度的情况可以看作速度依赖的特殊情况，此情况下，由于附加质量导致的向心力-科氏力是$\beta$中唯一包含的项。

+ A、B、K矩阵的特性

​	当计算水动力时，以下属性比较有用：

🚩$w=0$时的渐进值：
$$
B(0)=0
$$
🚩$w=\infty$时的渐进值：
$$
\begin{aligned}
\mathbf{A}_U(\infty, U) &= 0 \\
\mathbf{A}_U(\infty, U) &= \mathbf{A}(\infty)
\end{aligned}
$$
​	由于多数的耐波性程序仅仅返回$w\in(w_{min},w_{max})$时的积分，这个性质可以被用于计算$K(t)$。

🚩$t=0$时的渐进值：
$$
\begin{aligned}
\lim_{t \to 0} \mathbf{K}(t) \neq 0 < \infty
\end{aligned}
$$
🚩$t=\infty$时的渐进值：
$$
\begin{aligned}
\lim_{t \to \infty} \mathbf{K}(t) = 0
\end{aligned}
$$

#### 5.4.3 考虑流体记忆效应的耐波性和操纵性非线性统一模型

​	对于零速度模型(235),线性科氏力-向心力矩阵$C^*_{RB}$、$C^*_{A}$可以使用它们的非线性项$C_{RB}(v)$、$C_A(v_r)$替代。另外，非线性阻尼$D(v_r)v_r$或者操纵性系数可以直接添加在时域模型中。

​	下面是一个融合了操纵性和耐波性理论的模型的表达：
$$
\begin{aligned}
\dot \eta &= J_{\Theta}(\eta)v \\
\mathbf{M}_{\dot v_r} + \mathbf{C}_{RB}(v)v + \mathbf{C}_A(v_r)v_r + \mathbf{D}(v_r)v_r + \mathbf{\mu} + \mathbf{G}\eta &= \mathbf{\tau}_{wind} + \mathbf{\tau}_{wave} + \mathbf{\tau}
\end{aligned}
$$
​	耐波性的流体记忆效应包含在$\mu$中：
$$
\begin{aligned}
\boldsymbol{\mu} := \int_0^1 \mathbf{K}(t - \tau) \underbrace{\left[ v(\tau) - U\mathbf{e}_1 \right]}_{\delta v} \, d\tau
\end{aligned}
$$
​	当洋流速度为常数且无旋时(相对于n系)，公式(245)可以简化：
$$
\begin{aligned}
\mathbf{M}\dot v_r + \mathbf{C}(v_r)v_r + \mathbf{D}(v_r)v_r + \mathbf{\mu} + \mathbf{G} \eta&= \mathbf{\tau}_{wind} + \mathbf{\tau}_{wave} + \mathbf{\tau}
\end{aligned}
$$

> [!CAUTION]
>
> 🎈耐波性模型的应用案例：航行器位置保持任务。
>
> 🚤 任务要求航行器状态满足：
> $$
> U=0\ \ r=0
> $$
> 则：
> $$
> C_{RB}(v)=C_A(v_r)=0 \ \ D(v_r)=D
> $$
> 带入到公式(247)中：
> $$
> \begin{aligned}
> \dot{\boldsymbol{\eta}} &= \mathbf{J}_{\Theta}(\boldsymbol{\eta})\mathbf{v} \\
> \mathbf{M}\dot{\mathbf{v}}_r + \mathbf{D}\mathbf{v}_r + \boldsymbol{\mu} + \mathbf{G}\boldsymbol{\eta} &= \boldsymbol{\tau}_{\text{wind}} + \boldsymbol{\tau}_{\text{wave}} + \boldsymbol{\tau}
> \end{aligned}
> $$
> 



## 6. 操纵性(Maneuvering) 

### 6.1 刚体运动学



### 6.2 水动力系数



### 6.3 附加质量



### 6.3 粘性阻尼与洋流力





### 6.4 操纵性方程



## 7. 水下航行器动力学建模

### 7.1 操纵性模型



### 7.2 首向控制模型



### 7.3 DP 模型(Dynamic Positioning)



### 7.4 包含ROLL的操纵性模型



### 7.5 六自由度运动方程





## 8.环境力

### 8.1 波浪载荷



### 8.2 海流
